!function($){"use strict";void 0===$.oc&&($.oc={}),void 0===$.oc.table&&($.oc.table={});var Table=function(element,options){if(this.el=element,this.$el=$(element),this.options=options,this.disposed=!1,this.dataSource=null,this.cellProcessors={},this.activeCellProcessor=null,this.activeCell=null,this.tableContainer=null,this.dataTableContainer=null,this.editedRowKey=null,this.dataTable=null,this.headerTable=null,this.toolbar=null,this.clickHandler=this.onClick.bind(this),this.keydownHandler=this.onKeydown.bind(this),this.documentClickHandler=this.onDocumentClick.bind(this),this.toolbarClickHandler=this.onToolbarClick.bind(this),this.options.postback&&"client"==this.options.clientDataSourceClass){if(!this.options.postbackHandlerName){var formHandler=this.$el.closest("form").data("request");this.options.postbackHandlerName=formHandler||"onSave"}this.formSubmitHandler=this.onFormSubmit.bind(this)}this.navigation=null,this.search=null,this.recordsAddedOrDeleted=0,this.disposeBound=this.dispose.bind(this),this.init(),$.oc.foundation.controlUtils.markDisposable(element)};Table.prototype.init=function(){this.createDataSource(),this.initCellProcessors(),this.navigation=new $.oc.table.helper.navigation(this),this.search=new $.oc.table.helper.search(this),this.buildUi(),this.registerHandlers()},Table.prototype.disposeCellProcessors=function(){for(var i=0,len=this.options.columns.length;i<len;i++){var column=this.options.columns[i].key;this.cellProcessors[column].dispose(),this.cellProcessors[column]=null}this.cellProcessors=null,this.activeCellProcessor=null},Table.prototype.createDataSource=function(){var dataSourceClass=this.options.clientDataSourceClass;if(void 0===$.oc.table.datasource||null==$.oc.table.datasource[dataSourceClass])throw new Error('The table client-side data source class "'+dataSourceClass+'" is not found in the $.oc.table.datasource namespace.');this.dataSource=new $.oc.table.datasource[dataSourceClass](this)},Table.prototype.registerHandlers=function(){this.el.addEventListener("click",this.clickHandler),this.el.addEventListener("keydown",this.keydownHandler),this.$el.one("dispose-control",this.disposeBound),document.addEventListener("click",this.documentClickHandler),this.options.postback&&"client"==this.options.clientDataSourceClass&&this.$el.closest("form").bind("oc.beforeRequest",this.formSubmitHandler);var toolbar=this.getToolbar();toolbar&&toolbar.addEventListener("click",this.toolbarClickHandler)},Table.prototype.unregisterHandlers=function(){this.el.removeEventListener("click",this.clickHandler),document.removeEventListener("click",this.documentClickHandler),this.clickHandler=null,this.el.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null;var toolbar=this.getToolbar();toolbar&&toolbar.removeEventListener("click",this.toolbarClickHandler),this.toolbarClickHandler=null,this.formSubmitHandler&&(this.$el.closest("form").unbind("oc.beforeRequest",this.formSubmitHandler),this.formSubmitHandler=null)},Table.prototype.initCellProcessors=function(){for(var i=0,len=this.options.columns.length;i<len;i++){var columnConfiguration=this.options.columns[i],column=columnConfiguration.key,columnType=columnConfiguration.type;if(void 0===columnType&&(columnType="string",this.options.columns[i].type=columnType),void 0===$.oc.table.processor||null==$.oc.table.processor[columnType])throw new Error('The table cell processor for the column type "'+columnType+'" is not found in the $.oc.table.processor namespace.');this.cellProcessors[column]=new $.oc.table.processor[columnType](this,column,columnConfiguration)}},Table.prototype.getCellProcessor=function(columnName){return this.cellProcessors[columnName]},Table.prototype.buildUi=function(){this.tableContainer=document.createElement("div"),this.tableContainer.setAttribute("class","table-container"),this.options.toolbar&&this.buildToolbar(),this.tableContainer.appendChild(this.buildHeaderTable()),this.el.insertBefore(this.tableContainer,this.el.children[0]),this.options.height?this.dataTableContainer=this.buildScrollbar():this.dataTableContainer=this.tableContainer,this.updateDataTable()},Table.prototype.buildToolbar=function(){(this.options.adding||this.options.deleting)&&(this.toolbar=$($("[data-table-toolbar]",this.el).html()).appendTo(this.tableContainer).get(0),this.options.adding?this.navigation.paginationEnabled()||!this.options.rowSorting?$("[data-cmd=record-add-below], [data-cmd=record-add-above]",this.toolbar).remove():$("[data-cmd=record-add]",this.toolbar).remove():$('[data-cmd^="record-add"]',this.toolbar).remove(),this.options.deleting||$('[data-cmd="record-delete"]',this.toolbar).remove())},Table.prototype.buildScrollbar=function(){var scrollbar=document.createElement("div"),scrollbarContent=document.createElement("div");return scrollbar.setAttribute("class","control-scrollbar"),this.options.dynamicHeight?scrollbar.setAttribute("style","max-height: "+this.options.height+"px"):scrollbar.setAttribute("style","height: "+this.options.height+"px"),scrollbar.appendChild(scrollbarContent),this.tableContainer.appendChild(scrollbar),$(scrollbar).scrollbar({animation:!1}),scrollbarContent},Table.prototype.buildHeaderTable=function(){var headersTable=document.createElement("table"),row=document.createElement("tr");headersTable.className="headers",headersTable.appendChild(row);for(var i=0,len=this.options.columns.length;i<len;i++){var header=document.createElement("th");this.options.columns[i].width&&header.setAttribute("style","width: "+this.options.columns[i].width),void 0!==header.textContent?header.textContent=this.options.columns[i].title:header.innerText=this.options.columns[i].title,row.appendChild(header)}return this.headerTable=headersTable,headersTable},Table.prototype.updateDataTable=function(onSuccess){var self=this;this.unfocusTable(),this.fetchRecords((function(records,totalCount){self.buildDataTable(records,totalCount),onSuccess&&onSuccess(),0==totalCount&&self.addRecord("above",!0),self.$el.trigger("oc.tableUpdateData",[records,totalCount]),self=null}))},Table.prototype.updateColumnWidth=function(){for(var headerCells=this.headerTable.querySelectorAll("th"),dataCells=this.dataTable.querySelectorAll("tr:first-child td"),i=0,len=headerCells.length;i<len;i++)dataCells[i]&&dataCells[i].setAttribute("style",headerCells[i].getAttribute("style"))},Table.prototype.buildDataTable=function(records,totalCount){var dataTable=document.createElement("table"),tbody=document.createElement("tbody"),keyColumn=this.options.keyColumn;dataTable.setAttribute("class","data");for(var i=0,len=records.length;i<len;i++){var row=document.createElement("tr");if(void 0===records[i][keyColumn])throw new Error("The row attribute "+keyColumn+" is not set for the row #"+i);row.setAttribute("data-row",records[i][keyColumn]);for(var j=0,colsLen=this.options.columns.length;j<colsLen;j++){var cell=document.createElement("td"),dataContainer=document.createElement("input"),cellContentContainer=document.createElement("div"),column=this.options.columns[j],columnName=column.key,cellProcessor=this.getCellProcessor(columnName);cell.setAttribute("data-column",columnName),cell.setAttribute("data-column-type",column.type),dataContainer.setAttribute("type","hidden"),dataContainer.setAttribute("data-container","data-container"),dataContainer.value=this.formatDataContainerValue(records[i][columnName]),cellContentContainer.setAttribute("class","content-container"),cell.appendChild(cellContentContainer),row.appendChild(cell),cell.appendChild(dataContainer),cellProcessor.renderCell(records[i][columnName],cellContentContainer)}tbody.appendChild(row)}dataTable.appendChild(tbody),null!==this.dataTable?this.dataTableContainer.replaceChild(dataTable,this.dataTable):this.dataTableContainer.appendChild(dataTable),this.dataTable=dataTable,this.updateColumnWidth(),this.updateScrollbar(),this.navigation.buildPagination(totalCount),this.search.buildSearchForm()},Table.prototype.formatDataContainerValue=function(value){return void 0===value?"":"boolean"==typeof value?value?1:"":value},Table.prototype.fetchRecords=function(onSuccess){this.search.hasQuery()?this.dataSource.searchRecords(this.search.getQuery(),this.navigation.getPageFirstRowOffset(),this.options.recordsPerPage,onSuccess):this.dataSource.getRecords(this.navigation.getPageFirstRowOffset(),this.options.recordsPerPage,onSuccess)},Table.prototype.updateScrollbar=function(){this.options.height&&$(this.dataTableContainer.parentNode).data("oc.scrollbar").update()},Table.prototype.scrollCellIntoView=function(){this.options.height&&this.activeCell&&$(this.dataTableContainer.parentNode).data("oc.scrollbar").gotoElement(this.activeCell)},Table.prototype.disposeScrollbar=function(){this.options.height&&($(this.dataTableContainer.parentNode).data("oc.scrollbar").dispose(),$(this.dataTableContainer.parentNode).data("oc.scrollbar",null))},Table.prototype.setActiveProcessor=function(processor){this.activeCellProcessor&&this.activeCellProcessor.onUnfocus(),this.activeCellProcessor=processor},Table.prototype.commitEditedRow=function(){if(null!==this.editedRowKey){var editedRow=this.dataTable.querySelector('tr[data-row="'+this.editedRowKey+'"]');if(editedRow&&1==editedRow.getAttribute("data-dirty")){for(var cells=editedRow.children,data={},i=0,len=cells.length;i<len;i++){var cell=cells[i];data[cell.getAttribute("data-column")]=this.getCellValue(cell)}this.dataSource.updateRecord(this.editedRowKey,data),editedRow.setAttribute("data-dirty",0)}}},Table.prototype.unfocusTable=function(){this.elementRemoveClass(this.el,"active"),this.activeCellProcessor&&this.activeCellProcessor.onUnfocus(),this.commitEditedRow(),this.activeCellProcessor=null,this.activeCell&&this.activeCell.setAttribute("class",""),this.activeCell=null},Table.prototype.focusTable=function(){this.elementAddClass(this.el,"active")},Table.prototype.focusCell=function(cellElement,isClick){var columnName=cellElement.getAttribute("data-column");if(null!==columnName){this.focusTable();var processor=this.getCellProcessor(columnName);if(!processor)throw new Error("Cell processor not found for the column "+columnName);this.activeCell!==cellElement&&(this.activeCell&&this.elementRemoveClass(this.activeCell,"active"),this.setActiveProcessor(processor),this.activeCell=cellElement,processor.isCellFocusable()&&this.elementAddClass(this.activeCell,"active"));var rowKey=this.getCellRowKey(cellElement);null!==this.editedRowKey&&rowKey!=this.editedRowKey&&this.commitEditedRow(),this.editedRowKey=rowKey,processor.onFocus(cellElement,isClick),this.scrollCellIntoView()}},Table.prototype.markCellRowDirty=function(cellElement){cellElement.parentNode.setAttribute("data-dirty",1)},Table.prototype.addRecord=function(placement,noFocus){this.activeCell&&!this.navigation.paginationEnabled()&&this.options.rowSorting||(placement="bottom");var relativeToKey=null,currentRowIndex=null;if("above"!=placement&&"below"!=placement||(relativeToKey=this.getCellRowKey(this.activeCell),currentRowIndex=this.getCellRowIndex(this.activeCell)),this.unfocusTable(),this.navigation.paginationEnabled()){var newPageIndex=this.navigation.getNewRowPage(placement,currentRowIndex);if(newPageIndex!=this.navigation.pageIndex&&!this.validate())return;this.navigation.pageIndex=newPageIndex}this.recordsAddedOrDeleted++;var keyColumn=this.options.keyColumn,recordData={},self=this;recordData[keyColumn]=-1*this.recordsAddedOrDeleted,this.$el.trigger("oc.tableNewRow",[recordData]),this.dataSource.createRecord(recordData,placement,relativeToKey,this.navigation.getPageFirstRowOffset(),this.options.recordsPerPage,(function(records,totalCount){self.buildDataTable(records,totalCount);var row=self.findRowByKey(recordData[keyColumn]);if(!row)throw new Error("New row is not found in the updated table: "+recordData[keyColumn]);noFocus||self.navigation.focusCell(row,0),self=null}))},Table.prototype.deleteRecord=function(){if(this.activeCell){var currentRowIndex=this.getCellRowIndex(this.activeCell),key=this.getCellRowKey(this.activeCell),self=this,paginationEnabled=this.navigation.paginationEnabled(),currentPageIndex=this.navigation.pageIndex,currentCellIndex=this.activeCell.cellIndex;paginationEnabled&&(this.navigation.pageIndex=this.navigation.getPageAfterDeletion(currentRowIndex)),this.recordsAddedOrDeleted++;var newRecordData={};newRecordData[this.options.keyColumn]=-1*this.recordsAddedOrDeleted,this.dataSource.deleteRecord(key,newRecordData,this.navigation.getPageFirstRowOffset(),this.options.recordsPerPage,(function(records,totalCount){self.buildDataTable(records,totalCount),paginationEnabled&&currentPageIndex!=self.navigation.pageIndex?self.navigation.focusCell("bottom",currentCellIndex):self.navigation.focusCellInReplacedRow(currentRowIndex,currentCellIndex),self=null}))}},Table.prototype.notifyRowProcessorsOnChange=function(cellElement){for(var columnName=cellElement.getAttribute("data-column"),row=cellElement.parentNode,i=0,len=row.children.length;i<len;i++){var column=this.options.columns[i].key;this.cellProcessors[column].onRowValueChanged(columnName,row.children[i])}},Table.prototype.getToolbar=function(){return this.tableContainer.querySelector("div.toolbar")},Table.prototype.validate=function(){for(var rows=this.dataTable.querySelectorAll("tbody tr[data-row]"),i=0,len=rows.length;i<len;i++){var row=rows[i];this.elementRemoveClass(row,"error")}i=0;for(var rowsLen=rows.length;i<rowsLen;i++){row=rows[i];for(var rowData=this.getRowData(row),j=0,colsLen=row.children.length;j<colsLen;j++)this.elementRemoveClass(row.children[j],"error");for(var columnName in rowData){var cellProcessor=this.getCellProcessor(columnName),message=cellProcessor.validate(rowData[columnName],rowData);if(void 0!==message){var cell=row.querySelector('td[data-column="'+columnName+'"]'),self=this;return this.elementAddClass(row,"error"),this.elementAddClass(cell,"error"),$.oc.flashMsg({text:message,class:"error"}),window.setTimeout((function(){self.focusCell(cell,!1),cell=null,self=null,cellProcessor=null}),100),!1}}}return!0},Table.prototype.onClick=function(ev){if(this.focusTable(),!1!==this.navigation.onClick(ev)&&!1!==this.search.onClick(ev)){for(var i=0,len=this.options.columns.length;i<len;i++){var column=this.options.columns[i].key;this.cellProcessors[column].onClick(ev)}var target=this.getEventTarget(ev,"TD");target&&"TD"==target.tagName?this.focusCell(target,!0):this.unfocusTable()}},Table.prototype.onKeydown=function(ev){if(("a"===ev.key||"A"===ev.key)&&ev.altKey&&this.options.adding)return ev.shiftKey?this.addRecord("above"):this.addRecord("below"),void this.stopEvent(ev);if(("d"===ev.key||"D"===ev.key)&&ev.altKey&&this.options.deleting)return this.deleteRecord(),void this.stopEvent(ev);for(var i=0,len=this.options.columns.length;i<len;i++){var column=this.options.columns[i].key;if(!1===this.cellProcessors[column].onKeyDown(ev))return}!1!==this.navigation.onKeydown(ev)&&this.search.onKeydown(ev)},Table.prototype.onFormSubmit=function(ev,data){var isSubmitHandler=data.handler===this.options.postbackHandlerName;if(!isSubmitHandler||(this.unfocusTable(),this.validate())){if(isSubmitHandler||this.options.postbackHandlerWild){var fieldName=this.options.fieldName.indexOf("[")>-1?this.options.fieldName+"[TableData]":this.options.fieldName+"TableData";data.options.data[fieldName]=JSON.stringify(this.dataSource.getAllData())}}else ev.preventDefault()},Table.prototype.onToolbarClick=function(ev){var target=this.getEventTarget(ev,"BUTTON"),cmd=target&&target.getAttribute("data-cmd");if(cmd){switch(cmd){case"record-add":case"record-add-below":this.addRecord("below");break;case"record-add-above":this.addRecord("above");break;case"record-delete":this.deleteRecord()}this.stopEvent(ev)}},Table.prototype.onDocumentClick=function(ev){var target=this.getEventTarget(ev);this.parentContainsElement(this.el,target)||this.activeCellProcessor&&this.activeCellProcessor.elementBelongsToProcessor(target)||this.unfocusTable()},Table.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeBound=!0,this.unfocusTable(),this.dataSource.dispose(),this.dataSource=null,this.unregisterHandlers(),this.dataTable=null,this.headerTable=null,this.toolbar=null,this.disposeCellProcessors(),this.navigation.dispose(),this.navigation=null,this.disposeScrollbar(),this.el=null,this.tableContainer=null,this.$el=null,this.dataTableContainer=null,this.activeCell=null)},Table.prototype.setRowValues=function(rowIndex,rowValues){var row=this.findRowByIndex(rowIndex);if(!row)return!1;for(var dataUpdated=!1,i=0,len=row.children.length;i<len;i++){var cell=row.children[i],cellColumnName=this.getCellColumnName(cell);for(var rowColumnName in rowValues)rowColumnName==cellColumnName&&(this.setCellValue(cell,rowValues[rowColumnName],!0),dataUpdated=!0)}if(dataUpdated){var originalEditedRowKey=this.editedRowKey;this.editedRowKey=this.getRowKey(row),this.commitEditedRow(),this.editedRowKey=originalEditedRowKey}return!0},Table.prototype.getElement=function(){return this.el},Table.prototype.getAlias=function(){return this.options.alias},Table.prototype.getTableContainer=function(){return this.tableContainer},Table.prototype.getDataTableBody=function(){return this.dataTable.children[0]},Table.prototype.getEventTarget=function(ev,tag){var target=ev.target?ev.target:ev.srcElement;if(void 0===tag)return target;for(var tagName=target.tagName;tagName!=tag;){if(!(target=target.parentNode))return null;tagName=target.tagName}return target},Table.prototype.stopEvent=function(ev){ev.stopPropagation?ev.stopPropagation():ev.cancelBubble=!0,ev.preventDefault?ev.preventDefault():ev.returnValue=!1},Table.prototype.elementHasClass=function(el,className){return el.classList?el.classList.contains(className):new RegExp("(^| )"+className+"( |$)","gi").test(el.className)},Table.prototype.elementAddClass=function(el,className){this.elementHasClass(el,className)||(el.classList?el.classList.add(className):el.className+=" "+className)},Table.prototype.elementRemoveClass=function(el,className){el.classList?el.classList.remove(className):el.className=el.className.replace(new RegExp("(^|\\b)"+className.split(" ").join("|")+"(\\b|$)","gi")," ")},Table.prototype.parentContainsElement=function(parent,element){for(;element&&element!=parent;)element=element.parentNode;return!!element},Table.prototype.getCellValue=function(cellElement){return cellElement.querySelector("[data-container]").value},Table.prototype.getCellRowKey=function(cellElement){return parseInt(cellElement.parentNode.getAttribute("data-row"))},Table.prototype.getRowKey=function(rowElement){return parseInt(rowElement.getAttribute("data-row"))},Table.prototype.findRowByKey=function(key){return this.dataTable.querySelector('tbody tr[data-row="'+key+'"]')},Table.prototype.findRowByIndex=function(index){return this.getDataTableBody().children[index]},Table.prototype.getCellRowIndex=function(cellElement){return parseInt(cellElement.parentNode.rowIndex)},Table.prototype.getRowCellValueByColumnName=function(row,columnName){var cell=row.querySelector('td[data-column="'+columnName+'"]');return cell?this.getCellValue(cell):cell},Table.prototype.getRowData=function(row){for(var result={},i=0,len=row.children.length;i<len;i++){var cell=row.children[i];result[cell.getAttribute("data-column")]=this.getCellValue(cell)}return result},Table.prototype.getCellColumnName=function(cellElement){return cellElement.getAttribute("data-column")},Table.prototype.setCellValue=function(cellElement,value,suppressEvents){var dataContainer=cellElement.querySelector("[data-container]");dataContainer.value!=value&&(dataContainer.value=value,this.markCellRowDirty(cellElement),this.notifyRowProcessorsOnChange(cellElement),void 0!==suppressEvents&&suppressEvents||this.$el.trigger("oc.tableCellChanged",[this.getCellColumnName(cellElement),value,this.getCellRowIndex(cellElement)]))},Table.DEFAULTS={clientDataSourceClass:"client",keyColumn:"id",recordsPerPage:!1,data:null,postback:!0,postbackHandlerName:null,postbackHandlerWild:!1,adding:!0,deleting:!0,toolbar:!0,searching:!1,rowSorting:!1,height:!1,dynamicHeight:!1};var old=$.fn.table;$.fn.table=function(option){var args=Array.prototype.slice.call(arguments,1),result=void 0;return this.each((function(){var $this=$(this),data=$this.data("oc.table"),options=$.extend({},Table.DEFAULTS,$this.data(),"object"==typeof option&&option);if(data||$this.data("oc.table",data=new Table(this,options)),"string"==typeof option&&(result=data[option].apply(data,args)),void 0!==result)return!1})),result||this},$.fn.table.Constructor=Table,$.oc.table.table=Table,$.fn.table.noConflict=function(){return $.fn.table=old,this},$(document).on("render",(function(){$("div[data-control=table]").table()}))}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");void 0===$.oc.table.helper&&($.oc.table.helper={});var Navigation=function(tableObj){this.tableObj=tableObj,this.pageIndex=0,this.pageCount=0,this.init()};Navigation.prototype.init=function(){},Navigation.prototype.dispose=function(){this.tableObj=null},Navigation.prototype.paginationEnabled=function(){return null!=this.tableObj.options.recordsPerPage&&0!=this.tableObj.options.recordsPerPage},Navigation.prototype.getPageFirstRowOffset=function(){return this.pageIndex*this.tableObj.options.recordsPerPage},Navigation.prototype.buildPagination=function(recordCount){if(this.paginationEnabled()){var paginationContainer=this.tableObj.getElement().querySelector(".pagination"),newPaginationContainer=!1,curRecordCount=0;if(this.pageCount=this.calculatePageCount(recordCount,this.tableObj.options.recordsPerPage),paginationContainer?curRecordCount=this.getRecordCount(paginationContainer):((paginationContainer=document.createElement("div")).setAttribute("class","pagination"),newPaginationContainer=!0),newPaginationContainer||curRecordCount!=recordCount){paginationContainer.setAttribute("data-record-count",recordCount);var pageList=this.buildPaginationLinkList(recordCount,this.tableObj.options.recordsPerPage,this.pageIndex);newPaginationContainer?(paginationContainer.appendChild(pageList),this.tableObj.getElement().appendChild(paginationContainer)):paginationContainer.replaceChild(pageList,paginationContainer.children[0])}else this.markActiveLinkItem(paginationContainer,this.pageIndex)}},Navigation.prototype.calculatePageCount=function(recordCount,recordsPerPage){var pageCount=Math.ceil(recordCount/recordsPerPage);return pageCount||(pageCount=1),pageCount},Navigation.prototype.getRecordCount=function(paginationContainer){var container=paginationContainer||this.tableObj.getElement().querySelector(".pagination");return parseInt(container.getAttribute("data-record-count"))},Navigation.prototype.buildPaginationLinkList=function(recordCount,recordsPerPage,pageIndex){for(var pageCount=this.calculatePageCount(recordCount,recordsPerPage),pageList=document.createElement("ul"),i=0;i<pageCount;i++){var item=document.createElement("li"),link=document.createElement("a");i==pageIndex&&item.setAttribute("class","active"),link.innerText=i+1,link.setAttribute("data-page-index",i),link.setAttribute("href","#"),item.appendChild(link),pageList.appendChild(item),$(link).addClass("pagination-link")}return pageList},Navigation.prototype.markActiveLinkItem=function(paginationContainer,pageIndex){var activeItem=paginationContainer.querySelector(".active"),list=paginationContainer.children[0];activeItem.setAttribute("class","");for(var i=0,len=list.children.length;i<len;i++)i==pageIndex&&list.children[i].setAttribute("class","active")},Navigation.prototype.gotoPage=function(pageIndex,onSuccess){this.tableObj.unfocusTable(),this.tableObj.validate()&&(this.pageIndex=pageIndex,this.tableObj.updateDataTable(onSuccess))},Navigation.prototype.getRowCountOnPage=function(cellElement){return this.tableObj.getDataTableBody().children.length},Navigation.prototype.getNewRowPage=function(placement,currentRowIndex){var curRecordCount=this.getRecordCount();return"bottom"===placement?this.calculatePageCount(curRecordCount+1,this.tableObj.options.recordsPerPage)-1:"above"==placement?this.pageIndex:"below"==placement&&currentRowIndex==this.tableObj.options.recordsPerPage-1?this.pageIndex+1:this.pageIndex},Navigation.prototype.getPageAfterDeletion=function(currentRowIndex){return 0==currentRowIndex&&1==this.getRowCountOnPage()?0==this.pageIndex?0:this.pageIndex-1:this.pageIndex},Navigation.prototype.navigateDown=function(ev,forceCellIndex){if(this.tableObj.activeCell&&(!this.tableObj.activeCellProcessor||this.tableObj.activeCellProcessor.keyNavigationAllowed(ev,"down"))){var row=this.tableObj.activeCell.parentNode,newRow=ev.shiftKey?row.parentNode.children[row.parentNode.children.length-1]:row.nextElementSibling,cellIndex=void 0!==forceCellIndex?forceCellIndex:this.tableObj.activeCell.cellIndex;if(newRow){var cell=newRow.children[cellIndex];cell&&this.tableObj.focusCell(cell)}else{if(!this.paginationEnabled())return;if(this.pageIndex<this.pageCount-1){var self=this;this.gotoPage(this.pageIndex+1,(function(){self.focusCell("top",cellIndex),self=null}))}}}},Navigation.prototype.navigateUp=function(ev,forceCellIndex,isTab){if(this.tableObj.activeCell&&(!this.tableObj.activeCellProcessor||this.tableObj.activeCellProcessor.keyNavigationAllowed(ev,"up"))){var row=this.tableObj.activeCell.parentNode,newRow=!ev.shiftKey||isTab?row.previousElementSibling:row.parentNode.children[0],cellIndex=void 0!==forceCellIndex?forceCellIndex:this.tableObj.activeCell.cellIndex;if(newRow){var cell=newRow.children[cellIndex];cell&&this.tableObj.focusCell(cell)}else{if(!this.paginationEnabled())return;if(this.pageIndex>0){var self=this;this.gotoPage(this.pageIndex-1,(function(){self.focusCell("bottom",cellIndex),self=null}))}}}},Navigation.prototype.navigateLeft=function(ev,isTab){if(this.tableObj.activeCell&&(isTab||!this.tableObj.activeCellProcessor||this.tableObj.activeCellProcessor.keyNavigationAllowed(ev,"left"))){var row=this.tableObj.activeCell.parentNode,newIndex=!ev.shiftKey||isTab?this.tableObj.activeCell.cellIndex-1:0,cell=row.children[newIndex];cell?this.tableObj.focusCell(cell):this.navigateUp(ev,row.children.length-1,isTab)}},Navigation.prototype.navigateRight=function(ev,isTab){if(this.tableObj.activeCell&&(isTab||!this.tableObj.activeCellProcessor||this.tableObj.activeCellProcessor.keyNavigationAllowed(ev,"right"))){var row=this.tableObj.activeCell.parentNode,newIndex=ev.shiftKey?row.children.length-1:this.tableObj.activeCell.cellIndex+1,cell=row.children[newIndex];cell?this.tableObj.focusCell(cell):this.navigateDown(ev,0)}},Navigation.prototype.navigateNext=function(ev){this.tableObj.activeCell&&(this.tableObj.activeCellProcessor&&!this.tableObj.activeCellProcessor.keyNavigationAllowed(ev,"tab")||(ev.shiftKey?this.navigateLeft(ev,!0):this.navigateRight(ev,!0),this.tableObj.stopEvent(ev)))},Navigation.prototype.focusCell=function(rowReference,cellIndex){var row=null,tbody=this.tableObj.getDataTableBody();if("object"==typeof rowReference?row=rowReference:"bottom"==rowReference?row=tbody.children[tbody.children.length-1]:"top"==rowReference&&(row=tbody.children[0]),row){var cell=row.children[cellIndex];cell&&this.tableObj.focusCell(cell)}},Navigation.prototype.focusCellInReplacedRow=function(rowIndex,cellIndex){if(0==rowIndex)this.focusCell("top",cellIndex);else{var focusRow=this.tableObj.findRowByIndex(rowIndex);focusRow||(focusRow=this.tableObj.findRowByIndex(rowIndex-1)),focusRow?this.focusCell(focusRow,cellIndex):this.focusCell("top",cellIndex)}},Navigation.prototype.onKeydown=function(ev){return"ArrowDown"===ev.key?this.navigateDown(ev):"ArrowUp"===ev.key?this.navigateUp(ev):"ArrowLeft"===ev.key?this.navigateLeft(ev):"ArrowRight"===ev.key?this.navigateRight(ev):"Tab"===ev.key?this.navigateNext(ev):void 0},Navigation.prototype.onClick=function(ev){var target=this.tableObj.getEventTarget(ev,"A");if(target&&$(target).hasClass("pagination-link")){var pageIndex=parseInt(target.getAttribute("data-page-index"));if(null!==pageIndex)return this.gotoPage(pageIndex),this.tableObj.stopEvent(ev),!1}},$.oc.table.helper.navigation=Navigation}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");void 0===$.oc.table.helper&&($.oc.table.helper={});var Search=function(tableObj){this.tableObj=tableObj,this.searchForm=null,this.searchInput=null,this.inputTrackTimer=null,this.activeQuery=null,this.isActive=!1,this.init()};Search.prototype.init=function(){},Search.prototype.dispose=function(){this.tableObj=null,this.searchForm=null,this.searchInput=null},Search.prototype.buildSearchForm=function(){if(this.searchEnabled()){var el=this.tableObj.getElement(),toolbar=this.tableObj.getToolbar();toolbar.querySelector(".table-search")||(this.searchForm=$($("[data-table-toolbar-search]",el).html()).appendTo(toolbar).get(0),this.searchInput=$(".table-search-input",this.searchForm).get(0))}},Search.prototype.getQuery=function(){return $.trim(this.activeQuery)},Search.prototype.hasQuery=function(){return this.searchEnabled()&&$.trim(this.activeQuery).length>0},Search.prototype.searchEnabled=function(){return this.tableObj.options.searching},Search.prototype.performSearch=function(query,onSuccess){var isDirty=this.activeQuery!=query;this.activeQuery=query,isDirty&&this.tableObj.updateDataTable(onSuccess)},Search.prototype.onKeydown=function(ev){if("Tab"!==ev.key){if(this.isActive){var self=this;this.inputTrackTimer=window.setTimeout((function(){self.performSearch(self.searchInput.value)}),300)}}else this.onClick(ev)},Search.prototype.onClick=function(ev){var target=this.tableObj.getEventTarget(ev,"INPUT");this.isActive=target&&$(target).hasClass("table-search-input")},$.oc.table.helper.search=Search}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");void 0===$.oc.table.datasource&&($.oc.table.datasource={});var Base=function(tableObj){this.tableObj=tableObj};Base.prototype.dispose=function(){this.tableObj=null},Base.prototype.getRecords=function(offset,count,onSuccess){onSuccess([])},Base.prototype.searchRecords=function(query,offset,count,onSuccess){onSuccess([])},Base.prototype.createRecord=function(recordData,placement,relativeToKey,offset,count,onSuccess){onSuccess([],0)},Base.prototype.updateRecord=function(key,recordData){},Base.prototype.deleteRecord=function(key,newRecordData,offset,count,onSuccess){onSuccess([],0)},$.oc.table.datasource.base=Base}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.datasource)throw new Error("The $.oc.table.datasource namespace is not defined. Make sure that the table.datasource.base.js script is loaded.");var Base=$.oc.table.datasource.base,BaseProto=Base.prototype,Client=function(tableObj){Base.call(this,tableObj);var dataString=tableObj.getElement().getAttribute("data-data");if(null==dataString)throw new Error("The required data-data attribute is not found on the table control element.");this.data=JSON.parse(dataString)};(Client.prototype=Object.create(BaseProto)).constructor=Client,Client.prototype.dispose=function(){BaseProto.dispose.call(this),this.data=null},Client.prototype.getRecords=function(offset,count,onSuccess){onSuccess(count?this.data.slice(offset,offset+count):this.data,this.data.length)},Client.prototype.createRecord=function(recordData,placement,relativeToKey,offset,count,onSuccess){if("bottom"===placement)this.data.push(recordData);else if("above"==placement||"below"==placement){var recordIndex=this.getIndexOfKey(relativeToKey);"below"==placement&&recordIndex++,this.data.splice(recordIndex,0,recordData)}this.getRecords(offset,count,onSuccess)},Client.prototype.updateRecord=function(key,recordData){var recordIndex=this.getIndexOfKey(key);if(-1===recordIndex)throw new Error("Record with they key "+key+" is not found in the data set");recordData[this.tableObj.options.keyColumn]=key,this.data[recordIndex]=recordData},Client.prototype.deleteRecord=function(key,newRecordData,offset,count,onSuccess){var recordIndex=this.getIndexOfKey(key);if(-1===recordIndex)throw new Error("Record with they key "+key+" is not found in the data set");this.data.splice(recordIndex,1),0==this.data.length&&this.data.push(newRecordData),this.getRecords(offset,count,onSuccess)},Client.prototype.getIndexOfKey=function(key){var keyColumn=this.tableObj.options.keyColumn;return this.data.map((function(record){return record[keyColumn]+""})).indexOf(key+"")},Client.prototype.getAllData=function(){return this.data},$.oc.table.datasource.client=Client}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.datasource)throw new Error("The $.oc.table.datasource namespace is not defined. Make sure that the table.datasource.base.js script is loaded.");var Base=$.oc.table.datasource.base,BaseProto=Base.prototype,Server=function(tableObj){Base.call(this,tableObj);var dataString=tableObj.getElement().getAttribute("data-data");if(null==dataString)throw new Error("The required data-data attribute is not found on the table control element.");this.data=JSON.parse(dataString)};(Server.prototype=Object.create(BaseProto)).constructor=Server,Server.prototype.dispose=function(){BaseProto.dispose.call(this),this.data=null},Server.prototype.getRecords=function(offset,count,onSuccess){var handlerName=this.tableObj.getAlias()+"::onServerGetRecords";this.tableObj.$el.request(handlerName,{data:{offset:offset,count:count}}).done((function(data){onSuccess(data.records,data.count)}))},Server.prototype.searchRecords=function(query,offset,count,onSuccess){var handlerName=this.tableObj.getAlias()+"::onServerSearchRecords";this.tableObj.$el.request(handlerName,{data:{query:query,offset:offset,count:count}}).done((function(data){onSuccess(data.records,data.count)}))},Server.prototype.createRecord=function(recordData,placement,relativeToKey,offset,count,onSuccess){var handlerName=this.tableObj.getAlias()+"::onServerCreateRecord";this.tableObj.$el.request(handlerName,{data:{recordData:recordData,placement:placement,relativeToKey:relativeToKey,offset:offset,count:count}}).done((function(data){onSuccess(data.records,data.count)}))},Server.prototype.updateRecord=function(key,recordData){var handlerName=this.tableObj.getAlias()+"::onServerUpdateRecord";this.tableObj.$el.request(handlerName,{data:{key:key,recordData:recordData}})},Server.prototype.deleteRecord=function(key,newRecordData,offset,count,onSuccess){var handlerName=this.tableObj.getAlias()+"::onServerDeleteRecord";this.tableObj.$el.request(handlerName,{data:{key:key,offset:offset,count:count}}).done((function(data){onSuccess(data.records,data.count)}))},$.oc.table.datasource.server=Server}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");void 0===$.oc.table.processor&&($.oc.table.processor={});var Base=function(tableObj,columnName,columnConfiguration){this.tableObj=tableObj,this.columnName=columnName,this.columnConfiguration=columnConfiguration,this.activeCell=null,this.validators=[],this.registerHandlers(),this.initValidators()};Base.prototype.dispose=function(){this.unregisterHandlers(),this.tableObj=null,this.activeCell=null},Base.prototype.renderCell=function(value,cellContentContainer){},Base.prototype.registerHandlers=function(){},Base.prototype.unregisterHandlers=function(){},Base.prototype.onFocus=function(cellElement,isClick){},Base.prototype.onUnfocus=function(){},Base.prototype.onKeyDown=function(ev){},Base.prototype.onClick=function(ev){},Base.prototype.onRowValueChanged=function(columnName,cellElement){},Base.prototype.keyNavigationAllowed=function(ev,direction){return!0},Base.prototype.isCellFocusable=function(){return!0},Base.prototype.getCellContentContainer=function(cellElement){return cellElement.querySelector(".content-container")},Base.prototype.createViewContainer=function(cellContentContainer,value){var viewContainer=document.createElement("div");return viewContainer.setAttribute("data-view-container","data-view-container"),viewContainer.textContent=void 0===value?"":value,cellContentContainer.appendChild(viewContainer),viewContainer},Base.prototype.getViewContainer=function(cellElement){return cellElement.querySelector("[data-view-container]")},Base.prototype.showViewContainer=function(cellElement){return this.getViewContainer(cellElement).setAttribute("class","")},Base.prototype.hideViewContainer=function(cellElement){return this.getViewContainer(cellElement).setAttribute("class","oc-hide")},Base.prototype.setViewContainerValue=function(cellElement,value){return this.getViewContainer(cellElement).textContent=value},Base.prototype.elementBelongsToProcessor=function(element){return!1},Base.prototype.initValidators=function(){if(void 0!==this.columnConfiguration.validation)for(var validatorName in this.columnConfiguration.validation){if(void 0===$.oc.table.validator||null==$.oc.table.validator[validatorName])throw new Error('The table cell validator "'+validatorName+'" for the column "'+this.columnName+'" is not found in the $.oc.table.validator namespace.');var validator=new $.oc.table.validator[validatorName](this.columnConfiguration.validation[validatorName]);this.validators.push(validator)}},Base.prototype.validate=function(value,rowData){for(var i=0,len=this.validators.length;i<len;i++){var message=this.validators[i].validate(value,rowData);if(void 0!==message)return message}},$.oc.table.processor.base=Base}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var Base=$.oc.table.processor.base,BaseProto=Base.prototype,StringProcessor=function(tableObj,columnName,columnConfiguration){this.focusTimeoutHandler=this.onFocusTimeout.bind(this),Base.call(this,tableObj,columnName,columnConfiguration)};(StringProcessor.prototype=Object.create(BaseProto)).constructor=StringProcessor,StringProcessor.prototype.dispose=function(){BaseProto.dispose.call(this),this.focusTimeoutHandler=null},StringProcessor.prototype.renderCell=function(value,cellContentContainer){this.createViewContainer(cellContentContainer,value)},StringProcessor.prototype.onFocus=function(cellElement,isClick){this.activeCell!==cellElement&&(this.activeCell=cellElement,this.buildEditor(cellElement,this.getCellContentContainer(cellElement)))},StringProcessor.prototype.onUnfocus=function(){if(this.activeCell){var editor=this.activeCell.querySelector(".string-input");editor&&(this.tableObj.setCellValue(this.activeCell,editor.value),this.setViewContainerValue(this.activeCell,editor.value),editor.parentNode.removeChild(editor)),this.showViewContainer(this.activeCell),this.activeCell=null}},StringProcessor.prototype.buildEditor=function(cellElement,cellContentContainer){this.hideViewContainer(this.activeCell);var input=document.createElement("input");input.setAttribute("type","text"),input.setAttribute("class","string-input"),input.value=this.tableObj.getCellValue(cellElement),this.columnConfiguration.readOnly&&input.setAttribute("readonly",!0),cellContentContainer.appendChild(input),this.setCaretPosition(input,0),window.setTimeout(this.focusTimeoutHandler,0)},StringProcessor.prototype.keyNavigationAllowed=function(ev,direction){if("left"!=direction&&"right"!=direction)return!0;if(!this.activeCell)return!0;var editor=this.activeCell.querySelector(".string-input");if(!editor)return!0;var caretPosition=this.getCaretPosition(editor);return"left"==direction?0==caretPosition:"right"!=direction||caretPosition==editor.value.length},StringProcessor.prototype.onRowValueChanged=function(columnName,cellElement){if(columnName==this.columnName){var value=this.tableObj.getCellValue(cellElement);this.setViewContainerValue(cellElement,value)}},StringProcessor.prototype.onFocusTimeout=function(){if(this.activeCell){var editor=this.activeCell.querySelector(".string-input");editor&&(editor.focus(),this.setCaretPosition(editor,0))}},StringProcessor.prototype.getCaretPosition=function(input){if(document.selection){var selection=document.selection.createRange();return selection.moveStart("character",-input.value.length),selection.text.length}return void 0!==input.selectionStart?input.selectionStart:0},StringProcessor.prototype.setCaretPosition=function(input,position){if(document.selection){var range=input.createTextRange();setTimeout((function(){range.collapse(!0),range.moveStart("character",position),range.moveEnd("character",0),range.select()}),0)}return void 0!==input.selectionStart&&setTimeout((function(){input.selectionStart=position,input.selectionEnd=position}),0),0},$.oc.table.processor.string=StringProcessor}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var Base=$.oc.table.processor.base,BaseProto=Base.prototype,CheckboxProcessor=function(tableObj,columnName,columnConfiguration){Base.call(this,tableObj,columnName,columnConfiguration)};(CheckboxProcessor.prototype=Object.create(BaseProto)).constructor=CheckboxProcessor,CheckboxProcessor.prototype.dispose=function(){BaseProto.dispose.call(this)},CheckboxProcessor.prototype.isCellFocusable=function(){return!1},CheckboxProcessor.prototype.renderCell=function(value,cellContentContainer){var checkbox=document.createElement("input");checkbox.setAttribute("data-checkbox-element","true"),checkbox.setAttribute("tabindex","0"),checkbox.setAttribute("type","checkbox"),checkbox.setAttribute("class","form-check-input"),value&&0!=value&&"false"!=value&&(checkbox.checked=!0),cellContentContainer.appendChild(checkbox)},CheckboxProcessor.prototype.onFocus=function(cellElement,isClick){cellElement.querySelector("input[data-checkbox-element]").focus()},CheckboxProcessor.prototype.onClick=function(ev){var chkElement=ev.target;if(chkElement.getAttribute("data-checkbox-element")){if(this.getCheckboxContainerNode(chkElement).getAttribute("data-column")!==this.columnName)return;this.changeState(chkElement),$(chkElement).trigger("change")}},CheckboxProcessor.prototype.changeState=function(chkElement){var cell=this.getCheckboxContainerNode(chkElement);this.tableObj.setCellValue(cell,chkElement.checked?1:0)},CheckboxProcessor.prototype.getCheckboxContainerNode=function(checkbox){return checkbox.parentNode.parentNode},CheckboxProcessor.prototype.onRowValueChanged=function(columnName,cellElement){if(columnName===this.columnName){var checkbox=cellElement.querySelector("input[data-checkbox-element]"),value=this.tableObj.getCellValue(cellElement);checkbox.checked=!(!value||0==value||"false"==value)}},$.oc.table.processor.checkbox=CheckboxProcessor}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var Base=$.oc.table.processor.base,BaseProto=Base.prototype,DropdownProcessor=function(tableObj,columnName,columnConfiguration){this.itemListElement=null,this.cachedOptionPromises={},this.searching=!1,this.searchQuery=null,this.searchInterval=null,this.itemClickHandler=this.onItemClick.bind(this),this.itemKeyDownHandler=this.onItemKeyDown.bind(this),this.itemMouseMoveHandler=this.onItemMouseMove.bind(this),Base.call(this,tableObj,columnName,columnConfiguration)};(DropdownProcessor.prototype=Object.create(BaseProto)).constructor=DropdownProcessor,DropdownProcessor.prototype.dispose=function(){this.unregisterListHandlers(),this.itemClickHandler=null,this.itemKeyDownHandler=null,this.itemMouseMoveHandler=null,this.itemListElement=null,this.cachedOptionPromises=null,BaseProto.dispose.call(this)},DropdownProcessor.prototype.unregisterListHandlers=function(){this.itemListElement&&(this.itemListElement.removeEventListener("click",this.itemClickHandler),this.itemListElement.removeEventListener("keydown",this.itemKeyDownHandler),this.itemListElement.removeEventListener("mousemove",this.itemMouseMoveHandler))},DropdownProcessor.prototype.renderCell=function(value,cellContentContainer){var viewContainer=this.createViewContainer(cellContentContainer,"...");this.fetchOptions(cellContentContainer.parentNode,(function(options){void 0!==options[value]&&(viewContainer.textContent=options[value]),cellContentContainer.setAttribute("tabindex",0)}))},DropdownProcessor.prototype.onFocus=function(cellElement,isClick){if(this.activeCell!==cellElement){this.activeCell=cellElement;var cellContentContainer=this.getCellContentContainer(cellElement);this.buildEditor(cellElement,cellContentContainer,isClick),isClick||cellContentContainer.focus()}else this.showDropdown()},DropdownProcessor.prototype.onUnfocus=function(){this.activeCell&&(this.unregisterListHandlers(),this.hideDropdown(),this.itemListElement=null,this.activeCell=null)},DropdownProcessor.prototype.buildEditor=function(cellElement,cellContentContainer,isClick){var currentValue=this.tableObj.getCellValue(cellElement),containerPosition=this.getAbsolutePosition(cellContentContainer);self=this,this.itemListElement=document.createElement("div"),this.itemListElement.addEventListener("click",this.itemClickHandler),this.itemListElement.addEventListener("keydown",this.itemKeyDownHandler),this.itemListElement.addEventListener("mousemove",this.itemMouseMoveHandler),this.itemListElement.setAttribute("class","table-control-dropdown-list"),this.itemListElement.style.width=cellContentContainer.offsetWidth+2+"px",this.itemListElement.style.left=containerPosition.left+"px",this.itemListElement.style.top=containerPosition.top-2+cellContentContainer.offsetHeight+"px",this.fetchOptions(cellElement,(function(options){var listElement=document.createElement("ul");for(var value in options){var itemElement=document.createElement("li");itemElement.setAttribute("data-value",value),itemElement.textContent=options[value],itemElement.setAttribute("tabindex",0),value==currentValue&&itemElement.setAttribute("class","selected"),listElement.appendChild(itemElement)}self.itemListElement.appendChild(listElement),isClick&&self.showDropdown(),self=null}))},DropdownProcessor.prototype.hideDropdown=function(){if(this.itemListElement&&this.activeCell&&this.itemListElement.parentNode){var cellContentContainer=this.getCellContentContainer(this.activeCell);cellContentContainer.setAttribute("data-dropdown-open","false"),this.itemListElement.parentNode.removeChild(this.itemListElement),cellContentContainer.focus()}},DropdownProcessor.prototype.showDropdown=function(){if(this.itemListElement&&this.itemListElement.parentNode!==document.body){this.getCellContentContainer(this.activeCell).setAttribute("data-dropdown-open","true"),document.body.appendChild(this.itemListElement);var activeItemElement=this.itemListElement.querySelector("ul li.selected");activeItemElement||(activeItemElement=this.itemListElement.querySelector("ul li:first-child"))&&activeItemElement.setAttribute("class","selected"),activeItemElement&&window.setTimeout((function(){activeItemElement.focus()}),0)}},DropdownProcessor.prototype.fetchOptions=function(cellElement,onSuccess){if(this.columnConfiguration.options)onSuccess(this.columnConfiguration.options);else{var row=cellElement.parentNode,cachingKey=this.createOptionsCachingKey(row),viewContainer=this.getViewContainer(cellElement);if(viewContainer.setAttribute("class","loading"),!this.cachedOptionPromises[cachingKey]){var requestData={column:this.columnName,rowData:this.tableObj.getRowData(row)},handlerName=this.tableObj.getAlias()+"::onGetDropdownOptions";this.cachedOptionPromises[cachingKey]=this.tableObj.$el.request(handlerName,{data:requestData})}this.cachedOptionPromises[cachingKey].done((function(data){onSuccess(data.options)})).always((function(){viewContainer.setAttribute("class","")}))}},DropdownProcessor.prototype.createOptionsCachingKey=function(row){var cachingKey="non-dependent",dependsOn=this.columnConfiguration.dependsOn;if(dependsOn)if("object"==typeof dependsOn)for(var i=0,len=dependsOn.length;i<len;i++)cachingKey+=dependsOn[i]+this.tableObj.getRowCellValueByColumnName(row,dependsOn[i]);else cachingKey=dependsOn+this.tableObj.getRowCellValueByColumnName(row,dependsOn);return cachingKey},DropdownProcessor.prototype.getAbsolutePosition=function(element){var top=document.body.scrollTop,left=0;do{top+=element.offsetTop||0,top-=element.scrollTop||0,left+=element.offsetLeft||0,element=element.offsetParent}while(element);return{top:top,left:left}},DropdownProcessor.prototype.updateCellFromFocusedItem=function(focusedItem){focusedItem||(focusedItem=this.findFocusedItem()),this.setSelectedItem(focusedItem)},DropdownProcessor.prototype.findSelectedItem=function(){return this.itemListElement?this.itemListElement.querySelector("ul li.selected"):null},DropdownProcessor.prototype.setSelectedItem=function(item){if(!this.itemListElement)return null;"LI"==item.tagName&&this.itemListElement.contains(item)&&(this.itemListElement.querySelectorAll("ul li").forEach((function(option){option.removeAttribute("class")})),item.setAttribute("class","selected")),this.tableObj.setCellValue(this.activeCell,item.getAttribute("data-value")),this.setViewContainerValue(this.activeCell,item.textContent)},DropdownProcessor.prototype.findFocusedItem=function(){return this.itemListElement?this.itemListElement.querySelector("ul li:focus"):null},DropdownProcessor.prototype.onItemClick=function(ev){var target=this.tableObj.getEventTarget(ev);"LI"==target.tagName&&(target.focus(),this.updateCellFromFocusedItem(target),this.hideDropdown())},DropdownProcessor.prototype.onItemKeyDown=function(ev){if(this.itemListElement){if("ArrowDown"===ev.key||"ArrowUp"===ev.key){var focused=this.findFocusedItem(),newFocusedItem=focused.nextElementSibling;return"ArrowUp"===ev.key&&(newFocusedItem=focused.previousElementSibling),void(newFocusedItem&&newFocusedItem.focus())}return"Enter"===ev.key||"(Space character)"===ev.key||"Spacebar"===ev.key||" "===ev.key?(this.updateCellFromFocusedItem(),void this.hideDropdown()):"Tab"===ev.key?(this.updateCellFromFocusedItem(),this.tableObj.navigation.navigateNext(ev),void this.tableObj.stopEvent(ev)):void("Escape"!==ev.key?this.searchByTextInput(ev,!0):this.hideDropdown())}},DropdownProcessor.prototype.onItemMouseMove=function(ev){if(this.itemListElement){var target=this.tableObj.getEventTarget(ev);"LI"==target.tagName&&target.focus()}},DropdownProcessor.prototype.onKeyDown=function(ev){if(this.itemListElement)if("(Space character)"!==ev.key&&"Spacebar"!==ev.key&&" "!==ev.key||this.searching){if("ArrowDown"===ev.key||"ArrowUp"===ev.key){var newSelectedItem,selected=this.findSelectedItem();if(selected)newSelectedItem=selected.nextElementSibling,"ArrowUp"===ev.key&&(newSelectedItem=selected.previousElementSibling);else{if("ArrowUp"===ev.key)return!1;newSelectedItem=this.itemListElement.querySelector("ul li:first-child")}return newSelectedItem&&this.setSelectedItem(newSelectedItem),!1}this.searchByTextInput(ev)}else this.showDropdown()},DropdownProcessor.prototype.onRowValueChanged=function(columnName,cellElement){if(this.columnConfiguration.dependsOn){var dependsOnColumn=!1,dependsOn=this.columnConfiguration.dependsOn;if("object"==typeof dependsOn){for(var i=0,len=dependsOn.length;i<len;i++)if(dependsOn[i]==columnName){dependsOnColumn=!0;break}}else dependsOnColumn=dependsOn==columnName;if(dependsOnColumn){var currentValue=this.tableObj.getCellValue(cellElement),viewContainer=this.getViewContainer(cellElement);this.fetchOptions(cellElement,(function(options){var value=void 0!==options[currentValue]?options[currentValue]:"...";viewContainer.textContent=value,viewContainer=null}))}}},DropdownProcessor.prototype.elementBelongsToProcessor=function(element){return!!this.itemListElement&&this.tableObj.parentContainsElement(this.itemListElement,element)},DropdownProcessor.prototype.searchByTextInput=function(ev,focusOnly){void 0===focusOnly&&(focusOnly=!1);var character=ev.key;if(1===character.length||"Space"===character){this.searching||(this.searching=!0,this.searchQuery=""),this.searchQuery+="Space"===character?" ":character;var validItem=null,query=this.searchQuery;this.itemListElement.querySelectorAll("ul li").forEach((function(item){null===validItem&&item.dataset.value&&0===item.dataset.value.toLowerCase().indexOf(query.toLowerCase())&&(validItem=item)})),validItem?(!0===focusOnly?validItem.focus():this.setSelectedItem(validItem),this.searchInterval&&clearTimeout(this.searchInterval),this.searchInterval=setTimeout(this.cancelTextSearch.bind(this),1e3)):this.cancelTextSearch()}},DropdownProcessor.prototype.cancelTextSearch=function(){this.searching=!1,this.searchQuery=null,this.searchInterval=null},$.oc.table.processor.dropdown=DropdownProcessor}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var Base=$.oc.table.processor.string,BaseProto=Base.prototype,AutocompleteProcessor=function(tableObj,columnName,columnConfiguration){this.cachedOptionPromises={},Base.call(this,tableObj,columnName,columnConfiguration)};(AutocompleteProcessor.prototype=Object.create(BaseProto)).constructor=AutocompleteProcessor,AutocompleteProcessor.prototype.dispose=function(){this.cachedOptionPromises=null,BaseProto.dispose.call(this)},AutocompleteProcessor.prototype.onUnfocus=function(){this.activeCell&&(this.removeAutocomplete(),BaseProto.onUnfocus.call(this))},AutocompleteProcessor.prototype.renderCell=function(value,cellContentContainer){BaseProto.renderCell.call(this,value,cellContentContainer)},AutocompleteProcessor.prototype.buildEditor=function(cellElement,cellContentContainer,isClick){BaseProto.buildEditor.call(this,cellElement,cellContentContainer,isClick);var self=this;this.fetchOptions(cellElement,(function(options){self.buildAutoComplete(options),self=null}))},AutocompleteProcessor.prototype.fetchOptions=function(cellElement,onSuccess){if(this.columnConfiguration.options)void 0!==onSuccess&&onSuccess(this.columnConfiguration.options);else{if(!1===this.triggerGetOptions(onSuccess))return;var row=cellElement.parentNode,cachingKey=this.createOptionsCachingKey(row),viewContainer=this.getViewContainer(cellElement);if($.oc.foundation.element.addClass(viewContainer,"loading"),!this.cachedOptionPromises[cachingKey]){var requestData={column:this.columnName,rowData:this.tableObj.getRowData(row)},handlerName=this.tableObj.getAlias()+"::onGetAutocompleteOptions";this.cachedOptionPromises[cachingKey]=this.tableObj.$el.request(handlerName,{data:requestData})}this.cachedOptionPromises[cachingKey].done((function(data){void 0!==onSuccess&&onSuccess(data.options)})).always((function(){$.oc.foundation.element.removeClass(viewContainer,"loading")}))}},AutocompleteProcessor.prototype.createOptionsCachingKey=function(row){var cachingKey="non-dependent",dependsOn=this.columnConfiguration.dependsOn;if(dependsOn)if("object"==typeof dependsOn)for(var i=0,len=dependsOn.length;i<len;i++)cachingKey+=dependsOn[i]+this.tableObj.getRowCellValueByColumnName(row,dependsOn[i]);else cachingKey=dependsOn+this.tableObj.getRowCellValueByColumnName(row,dependsOn);return cachingKey},AutocompleteProcessor.prototype.triggerGetOptions=function(callback){var tableElement=this.tableObj.getElement();if(tableElement){var optionsEvent=$.Event("autocompleteitems.oc.table");return $(tableElement).trigger(optionsEvent,[{values:{},callback:callback,column:this.columnName,columnConfiguration:this.columnConfiguration}]),!optionsEvent.isDefaultPrevented()}},AutocompleteProcessor.prototype.getInput=function(){return this.activeCell?this.activeCell.querySelector(".string-input"):null},AutocompleteProcessor.prototype.buildAutoComplete=function(items){if(this.activeCell){var input=this.getInput();input&&(void 0===items&&(items=[]),$(input).autocomplete({source:this.prepareItems(items),matchWidth:!0,menu:'<ul class="autocomplete dropdown-menu table-widget-autocomplete"></ul>',bodyContainer:!0}))}},AutocompleteProcessor.prototype.prepareItems=function(items){var result={};if($.isArray(items))for(var i=0,len=items.length;i<len;i++)result[items[i]]=items[i];else result=items;return result},AutocompleteProcessor.prototype.removeAutocomplete=function(){var input=this.getInput();$(input).autocomplete("destroy")},$.oc.table.processor.autocomplete=AutocompleteProcessor}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");void 0===$.oc.table.validator&&($.oc.table.validator={});var Base=function(options){this.options=options};Base.prototype.validate=function(value,rowData){if(void 0===this.options.requiredWith||this.rowHasValue(this.options.requiredWith,rowData))return this.validateValue(value,rowData)},Base.prototype.validateValue=function(value,rowData){},Base.prototype.trim=function(value){return String.prototype.trim?value.trim():value.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},Base.prototype.getMessage=function(defaultValue){return void 0!==this.options.message?this.options.message:defaultValue},Base.prototype.rowHasValue=function(columnName,rowData){return void 0!==rowData[columnName]&&("boolean"==typeof rowData[columnName]?rowData[columnName]:this.trim(String(rowData[columnName])).length>0)},$.oc.table.validator.base=Base}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");var Base=$.oc.table.validator.base,BaseProto=Base.prototype,Required=function(options){Base.call(this,options)};(Required.prototype=Object.create(BaseProto)).constructor=Required,Required.prototype.validateValue=function(value,rowData){if(0===(value=this.trim(value)).length)return this.getMessage("The value should not be empty.")},$.oc.table.validator.required=Required}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");var Base=$.oc.table.validator.base,BaseProto=Base.prototype,BaseNumber=function(options){Base.call(this,options)};(BaseNumber.prototype=Object.create(BaseProto)).constructor=BaseNumber,BaseNumber.prototype.doCommonChecks=function(value){if(void 0!==this.options.min||void 0!==this.options.max){if(void 0!==this.options.min){if(void 0===this.options.min.value)throw new Error("The min.value parameter is not defined in the table validator configuration");if(value<this.options.min.value)return void 0!==this.options.min.message?this.options.min.message:"The value should not be less than "+this.options.min.value}if(void 0!==this.options.max){if(void 0===this.options.max.value)throw new Error("The max.value parameter is not defined in the table validator configuration");if(value>this.options.max.value)return void 0!==this.options.max.message?this.options.max.message:"The value should not be more than "+this.options.max.value}}},$.oc.table.validator.baseNumber=BaseNumber}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");if(void 0===$.oc.table.validator.baseNumber)throw new Error("The $.oc.table.validator.baseNumber namespace is not defined. Make sure that the table.validator.baseNumber.js script is loaded.");var Base=$.oc.table.validator.baseNumber,BaseProto=Base.prototype,Integer=function(options){Base.call(this,options)};(Integer.prototype=Object.create(BaseProto)).constructor=Integer,Integer.prototype.validateValue=function(value,rowData){if(0!=(value=this.trim(value)).length){if(!(this.options.allowNegative?/^\-?[0-9]*$/.test(value):/^[0-9]*$/.test(value))){var defaultMessage=this.options.allowNegative?"The value should be an integer.":"The value should be a positive integer";return this.getMessage(defaultMessage)}return this.doCommonChecks(parseInt(value))}},$.oc.table.validator.integer=Integer}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");if(void 0===$.oc.table.validator.baseNumber)throw new Error("The $.oc.table.validator.baseNumber namespace is not defined. Make sure that the table.validator.baseNumber.js script is loaded.");var Base=$.oc.table.validator.baseNumber,BaseProto=Base.prototype,Float=function(options){Base.call(this,options)};(Float.prototype=Object.create(BaseProto)).constructor=Float,Float.prototype.validateValue=function(value,rowData){if(0!=(value=this.trim(value)).length){if(!(this.options.allowNegative?/^[-]?([0-9]+\.[0-9]+|[0-9]+)$/.test(value):/^([0-9]+\.[0-9]+|[0-9]+)$/.test(value))){var defaultMessage=this.options.allowNegative?"The value should be a floating point number.":"The value should be a positive floating point number";return this.getMessage(defaultMessage)}return this.doCommonChecks(parseFloat(value))}},$.oc.table.validator.float=Float}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");var Base=$.oc.table.validator.base,BaseProto=Base.prototype,Length=function(options){Base.call(this,options)};(Length.prototype=Object.create(BaseProto)).constructor=Length,Length.prototype.validateValue=function(value,rowData){if(0!=(value=this.trim(value)).length&&(void 0!==this.options.min||void 0!==this.options.max)){if(void 0!==this.options.min){if(void 0===this.options.min.value)throw new Error("The min.value parameter is not defined in the Length table validator configuration");if(value.length<this.options.min.value)return void 0!==this.options.min.message?this.options.min.message:"The string should not be shorter than "+this.options.min.value}if(void 0!==this.options.max){if(void 0===this.options.max.value)throw new Error("The max.value parameter is not defined in the Length table validator configuration");if(value.length>this.options.max.value)return void 0!==this.options.max.message?this.options.max.message:"The string should not be longer than "+this.options.max.value}}},$.oc.table.validator.length=Length}(window.jQuery),function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.validator)throw new Error("The $.oc.table.validator namespace is not defined. Make sure that the table.validator.base.js script is loaded.");var Base=$.oc.table.validator.base,BaseProto=Base.prototype,Regex=function(options){Base.call(this,options)};(Regex.prototype=Object.create(BaseProto)).constructor=Regex,Regex.prototype.validateValue=function(value,rowData){if(0!=(value=this.trim(value)).length){if(void 0===this.options.pattern)throw new Error("The pattern parameter is not defined in the Regex table validator configuration");return new RegExp(this.options.pattern,this.options.modifiers).test(value)?void 0:this.getMessage("Invalid value format.")}},$.oc.table.validator.regex=Regex}(window.jQuery);
