!function($){"use strict";void 0===$.oc.mediaManager&&($.oc.mediaManager={});var Base=$.oc.foundation.base,BaseProto=Base.prototype,MediaManager=function(element,options){this.$el=$(element),this.$form=this.$el.closest("form"),this.options=options,Base.call(this),this.selectTimer=null,this.sidebarPreviewElement=null,this.itemListElement=null,this.scrollContentElement=null,this.thumbnailQueue=[],this.activeThumbnailQueueLength=0,this.sidebarThumbnailAjax=null,this.selectionMarker=null,this.dropzone=null,this.searchTrackInputTimer=null,this.navigationAjax=null,this.dblTouchTimer=null,this.dblTouchFlag=null,this.itemListPosition=null,this.init()};(MediaManager.prototype=Object.create(BaseProto)).constructor=MediaManager,MediaManager.prototype.dispose=function(){this.unregisterHandlers(),this.clearSelectTimer(),this.destroyUploader(),this.clearSearchTrackInputTimer(),this.releaseNavigationAjax(),this.clearDblTouchTimer(),this.removeAttachedControls(),this.removeScroll(),this.$el.removeData("oc.mediaManager"),this.$el=null,this.$form=null,this.sidebarPreviewElement=null,this.itemListElement=null,this.scrollContentElement=null,this.sidebarThumbnailAjax=null,this.selectionMarker=null,this.thumbnailQueue=[],this.navigationAjax=null,BaseProto.dispose.call(this)},MediaManager.prototype.getSelectedItems=function(returnNotProcessed,allowRootItem){var items=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),result=[];if(!allowRootItem){for(var filteredItems=[],i=0,len=items.length;i<len;i++){(item=items[i]).hasAttribute("data-root")||filteredItems.push(item)}items=filteredItems}if(!0===returnNotProcessed)return items;for(i=0,len=items.length;i<len;i++){var item,itemDetails={itemType:(item=items[i]).getAttribute("data-item-type"),path:item.getAttribute("data-path"),title:item.getAttribute("data-title"),documentType:item.getAttribute("data-document-type"),folder:item.getAttribute("data-folder"),publicUrl:item.getAttribute("data-public-url")};result.push(itemDetails)}return result},MediaManager.prototype.init=function(){this.itemListElement=this.$el.find('[data-control="item-list"]').get(0),this.scrollContentElement=this.itemListElement.querySelector(".scroll-wrapper"),this.options.bottomToolbar&&(this.$el.find('[data-control="bottom-toolbar"]').removeClass("oc-hide"),this.options.cropAndInsertButton&&this.$el.find('[data-popup-command="crop-and-insert"]').removeClass("oc-hide")),this.registerHandlers(),this.updateSidebarPreview(),this.generateThumbnails(),this.initUploader(),this.initScroll()},MediaManager.prototype.registerHandlers=function(){this.$el.on("dblclick",this.proxy(this.onNavigate)),this.$el.on("click.tree-path",'ul.tree-path, [data-control="sidebar-labels"]',this.proxy(this.onNavigate)),this.$el.on("click.command","[data-command]",this.proxy(this.onCommandClick)),this.$el.on("click.item",'[data-type="media-item"]',this.proxy(this.onItemClick)),this.$el.on("touchend",'[data-type="media-item"]',this.proxy(this.onItemTouch)),this.$el.on("change",'[data-control="sorting"]',this.proxy(this.onSortingChanged)),this.$el.on("input",'[data-control="search"]',this.proxy(this.onSearchChanged)),this.$el.on("mediarefresh",this.proxy(this.refresh)),this.$el.on("shown.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupShown)),this.$el.on("hidden.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupHidden)),this.$el.on("shown.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupShown)),this.$el.on("hidden.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupHidden)),this.$el.on("keydown",this.proxy(this.onKeyDown)),this.itemListElement&&this.itemListElement.addEventListener("mousedown",this.proxy(this.onListMouseDown))},MediaManager.prototype.unregisterHandlers=function(){this.$el.off("dblclick",this.proxy(this.onNavigate)),this.$el.off("click.tree-path",this.proxy(this.onNavigate)),this.$el.off("click.command",this.proxy(this.onCommandClick)),this.$el.off("click.item",this.proxy(this.onItemClick)),this.$el.off("touchend",'[data-type="media-item"]',this.proxy(this.onItemTouch)),this.$el.off("change",'[data-control="sorting"]',this.proxy(this.onSortingChanged)),this.$el.off("keyup",'[data-control="search"]',this.proxy(this.onSearchChanged)),this.$el.off("shown.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupShown)),this.$el.off("hidden.oc.popup",'[data-command="create-folder"]',this.proxy(this.onFolderPopupHidden)),this.$el.off("shown.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupShown)),this.$el.off("hidden.oc.popup",'[data-command="move"]',this.proxy(this.onMovePopupHidden)),this.$el.off("keydown",this.proxy(this.onKeyDown)),this.itemListElement&&(this.itemListElement.removeEventListener("mousedown",this.proxy(this.onListMouseDown)),this.itemListElement.removeEventListener("mousemove",this.proxy(this.onListMouseMove))),document.removeEventListener("mouseup",this.proxy(this.onListMouseUp))},MediaManager.prototype.changeView=function(view){var data={view:view,path:this.$el.find('[data-type="current-folder"]').val()};this.execNavigationRequest("onChangeView",data)},MediaManager.prototype.setFilter=function(filter){var data={filter:filter,path:this.$el.find('[data-type="current-folder"]').val()};this.execNavigationRequest("onSetFilter",data)},MediaManager.prototype.isSearchMode=function(){return"true"==this.$el.find('[data-type="search-mode"]').val()},MediaManager.prototype.initScroll=function(){this.$el.find(".control-scrollpad").scrollpad()},MediaManager.prototype.updateScroll=function(){this.$el.find(".control-scrollpad").scrollpad("update")},MediaManager.prototype.removeScroll=function(){this.$el.find(".control-scrollpad").scrollpad("dispose")},MediaManager.prototype.scrollToTop=function(){this.$el.find(".control-scrollpad").scrollpad("scrollToStart")},MediaManager.prototype.removeAttachedControls=function(){this.$el.find("[data-control=toolbar]").toolbar("dispose"),this.$el.find("[data-control=sorting]").select2("destroy")},MediaManager.prototype.clearSelectTimer=function(){null!==this.selectTimer&&(clearTimeout(this.selectTimer),this.selectTimer=null)},MediaManager.prototype.selectItem=function(node,expandSelection){if(expandSelection)"selected"==node.getAttribute("class")?node.setAttribute("class",""):node.setAttribute("class","selected");else{for(var items=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),i=0,len=items.length;i<len;i++)items[i].setAttribute("class","");node.setAttribute("class","selected")}node.focus(),this.clearSelectTimer(),this.isPreviewSidebarVisible()&&(this.selectTimer=setTimeout(this.proxy(this.updateSidebarPreview),100)),node.hasAttribute("data-root")&&!expandSelection?this.toggleMoveAndDelete(!0):this.toggleMoveAndDelete(!1),expandSelection&&this.unselectRoot()},MediaManager.prototype.toggleMoveAndDelete=function(value){$("[data-command=delete]",this.$el).prop("disabled",value),$("[data-command=move]",this.$el).prop("disabled",value)},MediaManager.prototype.unselectRoot=function(){var rootItem=this.$el.get(0).querySelector('[data-type="media-item"][data-root].selected');rootItem&&rootItem.setAttribute("class","")},MediaManager.prototype.clearDblTouchTimer=function(){null!==this.dblTouchTimer&&(clearTimeout(this.dblTouchTimer),this.dblTouchTimer=null)},MediaManager.prototype.clearDblTouchFlag=function(){this.dblTouchFlag=!1},MediaManager.prototype.selectFirstItem=function(){var firstItem=this.itemListElement.querySelector('[data-type="media-item"]:first-child');firstItem&&this.selectItem(firstItem)},MediaManager.prototype.selectRelative=function(next,expandSelection){var currentSelection=this.getSelectedItems(!0,!0);if(0!=currentSelection.length){var itemToSelect=null;if(next){var lastItem=currentSelection[currentSelection.length-1];lastItem&&(itemToSelect=lastItem.nextElementSibling)}else{var firstItem=currentSelection[0];firstItem&&(itemToSelect=firstItem.previousElementSibling)}itemToSelect&&this.selectItem(itemToSelect,expandSelection)}else this.selectFirstItem()},MediaManager.prototype.gotoFolder=function(path,resetSearch){var data={path:path,resetSearch:void 0!==resetSearch?1:0};this.execNavigationRequest("onGoToFolder",data)},MediaManager.prototype.afterNavigate=function(){this.scrollToTop(),this.generateThumbnails(),this.updateSidebarPreview(!0),this.selectFirstItem(),this.updateScroll()},MediaManager.prototype.refresh=function(){var data={path:this.$el.find('[data-type="current-folder"]').val(),clearCache:!0};this.execNavigationRequest("onGoToFolder",data)},MediaManager.prototype.execNavigationRequest=function(handler,data,element){if(void 0===element&&(element=this.$form),null!==this.navigationAjax){try{this.navigationAjax.abort()}catch(e){}this.releaseNavigationAjax()}$.oc.stripeLoadIndicator.show(),this.navigationAjax=element.request(this.options.alias+"::"+handler,{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.afterNavigate)).always(this.proxy(this.releaseNavigationAjax))},MediaManager.prototype.releaseNavigationAjax=function(){this.navigationAjax=null},MediaManager.prototype.navigateToItem=function($item){$item.length&&$item.data("path").length&&("folder"==$item.data("item-type")?$item.data("clear-search")?(this.resetSearch(),this.gotoFolder($item.data("path"),!0)):this.gotoFolder($item.data("path")):"file"==$item.data("item-type")&&this.$el.trigger("popupcommand",["insert"]))},MediaManager.prototype.isPreviewSidebarVisible=function(){return!this.$el.find('[data-control="preview-sidebar"]').hasClass("oc-hide")},MediaManager.prototype.toggleSidebar=function(ev){var isVisible=this.isPreviewSidebarVisible(),$sidebar=this.$el.find('[data-control="preview-sidebar"]'),$button=$(ev.target);isVisible?($sidebar.addClass("oc-hide"),$button.addClass("sidebar-hidden")):($sidebar.removeClass("oc-hide"),this.updateSidebarPreview(),$button.removeClass("sidebar-hidden")),this.$form.request(this.options.alias+"::onSetSidebarVisible",{data:{visible:isVisible?0:1}})},MediaManager.prototype.updateSidebarMediaPreview=function(items){for(var previewPanel=this.sidebarPreviewElement,previewContainer=previewPanel.querySelector('[data-control="media-preview-container"]'),template="",i=0,len=previewContainer.children.length;i<len;i++)previewContainer.removeChild(previewContainer.children[i]);if(1!=items.length||items[0].hasAttribute("data-root"))1==items.length&&items[0].hasAttribute("data-root")?(template=previewPanel.querySelector('[data-control="go-up"]').innerHTML,previewContainer.innerHTML=template):0==items.length?(template=previewPanel.querySelector('[data-control="no-selection-template"]').innerHTML,previewContainer.innerHTML=template):(template=previewPanel.querySelector('[data-control="multi-selection-template"]').innerHTML,previewContainer.innerHTML=template);else{var item=items[0],documentType=item.getAttribute("data-document-type");switch(documentType){case"audio":template=previewPanel.querySelector('[data-control="audio-template"]').innerHTML;break;case"video":template=previewPanel.querySelector('[data-control="video-template"]').innerHTML;break;case"image":template=previewPanel.querySelector('[data-control="image-template"]').innerHTML}previewContainer.innerHTML=template.replace("{src}",item.getAttribute("data-public-url")).replace("{path}",item.getAttribute("data-path")).replace("{last-modified}",item.getAttribute("data-last-modified-ts")),"image"==documentType&&this.loadSidebarThumbnail()}},MediaManager.prototype.updateSidebarPreview=function(resetSidebar){this.sidebarPreviewElement||(this.sidebarPreviewElement=this.$el.get(0).querySelector('[data-control="preview-sidebar"]'));var items=void 0===resetSidebar?this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'):[],previewPanel=this.sidebarPreviewElement;if(0==items.length)this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","oc-hide");else if(1!=items.length||items[0].hasAttribute("data-root"))this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","oc-hide");else{this.sidebarPreviewElement.querySelector('[data-control="sidebar-labels"]').setAttribute("class","panel");var item=items[0],lastModified=item.getAttribute("data-last-modified");if(previewPanel.querySelector('[data-label="size"]').textContent=item.getAttribute("data-size"),previewPanel.querySelector('[data-label="title"]').textContent=item.getAttribute("data-title"),previewPanel.querySelector('[data-label="last-modified"]').textContent=lastModified,previewPanel.querySelector('[data-label="public-url"]').setAttribute("href",item.getAttribute("data-public-url")),lastModified?previewPanel.querySelector('[data-control="last-modified"]').setAttribute("class",""):previewPanel.querySelector('[data-control="last-modified"]').setAttribute("class","oc-hide"),this.isSearchMode()){previewPanel.querySelector('[data-control="item-folder"]').setAttribute("class","");var folderNode=previewPanel.querySelector('[data-label="folder"]');folderNode.textContent=item.getAttribute("data-folder"),folderNode.setAttribute("data-path",item.getAttribute("data-folder"))}else previewPanel.querySelector('[data-control="item-folder"]').setAttribute("class","oc-hide")}this.updateSidebarMediaPreview(items)},MediaManager.prototype.loadSidebarThumbnail=function(){if(this.sidebarThumbnailAjax){try{this.sidebarThumbnailAjax.abort()}catch(e){}this.sidebarThumbnailAjax=null}var sidebarThumbnail=this.sidebarPreviewElement.querySelector('[data-control="sidebar-thumbnail"]');if(sidebarThumbnail){var data={path:sidebarThumbnail.getAttribute("data-path"),lastModified:sidebarThumbnail.getAttribute("data-last-modified")};this.sidebarThumbnailAjax=this.$form.request(this.options.alias+"::onGetSidebarThumbnail",{data:data}).done(this.proxy(this.replaceSidebarPlaceholder)).always(this.proxy(this.releaseSidebarThumbnailAjax))}},MediaManager.prototype.replaceSidebarPlaceholder=function(response){if(this.sidebarPreviewElement){var sidebarThumbnail=this.sidebarPreviewElement.querySelector('[data-control="sidebar-thumbnail"]');sidebarThumbnail&&response.markup&&(sidebarThumbnail.innerHTML=response.markup,sidebarThumbnail.removeAttribute("data-loading"))}},MediaManager.prototype.releaseSidebarThumbnailAjax=function(){this.sidebarThumbnailAjax=null},MediaManager.prototype.generateThumbnails=function(){this.thumbnailQueue=[];for(var placeholders=this.itemListElement.querySelectorAll('[data-type="media-item"] div.image-placeholder'),i=placeholders.length-1;i>=0;i--)this.thumbnailQueue.push({id:placeholders[i].getAttribute("id"),width:placeholders[i].getAttribute("data-width"),height:placeholders[i].getAttribute("data-height"),path:placeholders[i].getAttribute("data-path"),lastModified:placeholders[i].getAttribute("data-last-modified")});this.handleThumbnailQueue()},MediaManager.prototype.handleThumbnailQueue=function(){if(!(this.activeThumbnailQueueLength>=2))for(var i=this.activeThumbnailQueueLength;i<2&&this.thumbnailQueue.length>0;i++){for(var batch=[],j=0;j<3&&this.thumbnailQueue.length>0;j++)batch.push(this.thumbnailQueue.pop());this.activeThumbnailQueueLength++,this.handleThumbnailBatch(batch).always(this.proxy(this.placeholdersUpdated))}},MediaManager.prototype.handleThumbnailBatch=function(batch){for(var data={batch:batch},i=0,len=batch.length;i<len;i++){var placeholder=document.getElementById(batch[i].id);placeholder&&placeholder.setAttribute("data-loading","true")}var promise=this.$form.request(this.options.alias+"::onGenerateThumbnails",{data:data});return promise.done(this.proxy(this.replacePlaceholder)),promise},MediaManager.prototype.replacePlaceholder=function(response){if(response.generatedThumbnails)for(var i=0,len=response.generatedThumbnails.length;i<len;i++){var thumbnailInfo=response.generatedThumbnails[i];if(thumbnailInfo.id&&thumbnailInfo.markup){var node=document.getElementById(thumbnailInfo.id);if(node){var placeholderContainer=node.parentNode;placeholderContainer&&(placeholderContainer.innerHTML=thumbnailInfo.markup)}}}},MediaManager.prototype.placeholdersUpdated=function(){this.activeThumbnailQueueLength--,this.handleThumbnailQueue()},MediaManager.prototype.getRelativePosition=function(element,pageX,pageY,startPosition){var absolutePosition=void 0!==startPosition?startPosition:$.oc.foundation.element.absolutePosition(element,!0);return{x:pageX-absolutePosition.left,y:pageY-absolutePosition.top+this.scrollContentElement.scrollTop}},MediaManager.prototype.createSelectionMarker=function(){this.selectionMarker||(this.selectionMarker=document.createElement("div"),this.selectionMarker.setAttribute("data-control","selection-marker"),this.scrollContentElement.insertBefore(this.selectionMarker,this.scrollContentElement.firstChild))},MediaManager.prototype.doObjectsCollide=function(aTop,aLeft,aWidth,aHeight,bTop,bLeft,bWidth,bHeight){return!(aTop+aHeight<bTop||aTop>bTop+bHeight||aLeft+aWidth<bLeft||aLeft>bLeft+bWidth)},MediaManager.prototype.initUploader=function(){if(this.itemListElement&&!this.options.readOnly){var uploaderOptions={clickable:this.$el.find('[data-control="upload"]').get(0),url:this.options.url,paramName:"file_data",headers:{},timeout:0,createImageThumbnails:!1};this.options.uniqueId&&(uploaderOptions.headers["X-OCTOBER-FILEUPLOAD"]=this.options.uniqueId);var token=$('meta[name="csrf-token"]').attr("content");token&&(uploaderOptions.headers["X-CSRF-TOKEN"]=token),this.dropzone=new Dropzone(this.$el.get(0),uploaderOptions),this.dropzone.on("addedfile",this.proxy(this.uploadFileAdded)),this.dropzone.on("totaluploadprogress",this.proxy(this.uploadUpdateTotalProgress)),this.dropzone.on("queuecomplete",this.proxy(this.uploadQueueComplete)),this.dropzone.on("sending",this.proxy(this.uploadSending)),this.dropzone.on("error",this.proxy(this.uploadError)),this.dropzone.on("success",this.proxy(this.uploadSuccess))}},MediaManager.prototype.destroyUploader=function(){this.dropzone&&(this.dropzone.destroy(),this.dropzone=null)},MediaManager.prototype.uploadFileAdded=function(){this.showUploadUi(),this.setUploadProgress(0),this.$el.find('[data-command="cancel-uploading"]').removeClass("oc-hide"),this.$el.find('[data-command="close-uploader"]').addClass("oc-hide")},MediaManager.prototype.showUploadUi=function(){this.$el.find('[data-control="upload-ui"]').removeClass("oc-hide")},MediaManager.prototype.hideUploadUi=function(){this.$el.find('[data-control="upload-ui"]').addClass("oc-hide")},MediaManager.prototype.uploadUpdateTotalProgress=function(uploadProgress,totalBytes,totalBytesSent){this.setUploadProgress(uploadProgress);var fileNumberLabel=this.$el.get(0).querySelector('[data-label="file-number-and-progress"]'),messageTemplate=fileNumberLabel.getAttribute("data-message-template"),fileNumber=this.dropzone.getUploadingFiles().length+this.dropzone.getQueuedFiles().length;uploadProgress>=100&&(uploadProgress=99),fileNumberLabel.innerHTML=messageTemplate.replace(":number",fileNumber).replace(":percents",Math.round(uploadProgress)+"%")},MediaManager.prototype.setUploadProgress=function(value){var progressBar=this.$el.get(0).querySelector('[data-control="upload-progress-bar"]');progressBar.setAttribute("style","width: "+value+"%"),progressBar.setAttribute("class","progress-bar")},MediaManager.prototype.uploadQueueComplete=function(){this.$el.find('[data-command="cancel-uploading"]').addClass("oc-hide"),this.$el.find('[data-command="close-uploader"]').removeClass("oc-hide"),this.refresh()},MediaManager.prototype.uploadSending=function(file,xhr,formData){formData.append("path",this.$el.find('[data-type="current-folder"]').val())},MediaManager.prototype.uploadCancelAll=function(){this.dropzone.removeAllFiles(!0),this.hideUploadUi()},MediaManager.prototype.updateUploadBar=function(templateName,classNames){var fileNumberLabel=this.$el.get(0).querySelector('[data-label="file-number-and-progress"]'),successTemplate=fileNumberLabel.getAttribute("data-"+templateName+"-template"),progressBar=this.$el.get(0).querySelector('[data-control="upload-progress-bar"]');fileNumberLabel.innerHTML=successTemplate,progressBar.setAttribute("class",classNames)},MediaManager.prototype.uploadSuccess=function(){this.updateUploadBar("success","progress-bar bg-success")},MediaManager.prototype.uploadError=function(file,message){this.updateUploadBar("error","progress-bar bg-danger"),message||(message="Error uploading file"),$.oc.alert(message)},MediaManager.prototype.cropSelectedImage=function(callback){var selectedItems=this.getSelectedItems(!0);if(1==selectedItems.length)if("image"===selectedItems[0].getAttribute("data-document-type")){var path=selectedItems[0].getAttribute("data-path");new $.oc.mediaManager.imageCropPopup(path,{alias:this.options.alias,onDone:callback})}else alert(this.options.selectionNotImage);else alert(this.options.selectSingleImage)},MediaManager.prototype.onImageCropped=function(result){this.$el.trigger("popupcommand",["insert-cropped",result])},MediaManager.prototype.clearSearchTrackInputTimer=function(){null!==this.searchTrackInputTimer&&(clearTimeout(this.searchTrackInputTimer),this.searchTrackInputTimer=null)},MediaManager.prototype.updateSearchResults=function(){var $searchField=this.$el.find('[data-control="search"]'),data={search:$searchField.val()};this.execNavigationRequest("onSearch",data,$searchField)},MediaManager.prototype.resetSearch=function(){this.$el.find('[data-control="search"]').val("")},MediaManager.prototype.onSearchChanged=function(ev){var value=ev.currentTarget.value;void 0!==this.lastSearchValue&&this.lastSearchValue==value||(this.lastSearchValue=value,this.clearSearchTrackInputTimer(),this.searchTrackInputTimer=window.setTimeout(this.proxy(this.updateSearchResults),300))},MediaManager.prototype.deleteItems=function(){this.$el.get(0).querySelectorAll('[data-type="media-item"].selected').length?$.oc.confirm(this.options.deleteConfirm,this.proxy(this.deleteConfirmation)):$.oc.alert(this.options.deleteEmpty)},MediaManager.prototype.deleteConfirmation=function(confirmed){if(confirmed){for(var items=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),paths=[],i=0,len=items.length;i<len;i++)items[i].hasAttribute("data-root")||paths.push({path:items[i].getAttribute("data-path"),type:items[i].getAttribute("data-item-type")});var data={paths:paths};$.oc.stripeLoadIndicator.show(),this.$form.request(this.options.alias+"::onDeleteItem",{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.afterNavigate))}},MediaManager.prototype.createFolder=function(ev){$(ev.target).popup({content:this.$el.find('[data-control="new-folder-template"]').html()})},MediaManager.prototype.onFolderPopupShown=function(ev,button,popup){$(popup).find("input[name=name]").focus(),$(popup).on("submit.media","form",this.proxy(this.onNewFolderSubmit))},MediaManager.prototype.onFolderPopupHidden=function(ev,button,popup){$(popup).off(".media","form")},MediaManager.prototype.onNewFolderSubmit=function(ev){var data={name:$(ev.target).find("input[name=name]").val(),path:this.$el.find('[data-type="current-folder"]').val()};return $.oc.stripeLoadIndicator.show(),this.$form.request(this.options.alias+"::onCreateFolder",{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.folderCreated)),ev.preventDefault(),!1},MediaManager.prototype.folderCreated=function(){this.$el.find('button[data-command="create-folder"]').popup("hide"),this.afterNavigate()},MediaManager.prototype.moveItems=function(ev){var items=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected');if(items.length){for(var data={exclude:[],path:this.$el.find('[data-type="current-folder"]').val()},i=0,len=items.length;i<len;i++){var item=items[i],path=item.getAttribute("data-path");"folder"==item.getAttribute("data-item-type")&&data.exclude.push(path)}$(ev.target).popup({handler:this.options.alias+"::onLoadMovePopup",extraData:data})}else $.oc.alert(this.options.moveEmpty)},MediaManager.prototype.onMovePopupShown=function(ev,button,popup){$(popup).on("submit.media","form",this.proxy(this.onMoveItemsSubmit))},MediaManager.prototype.onMoveItemsSubmit=function(ev){for(var items=this.$el.get(0).querySelectorAll('[data-type="media-item"].selected'),data={dest:$(ev.target).find("select[name=dest]").val(),originalPath:$(ev.target).find("input[name=originalPath]").val(),files:[],folders:[]},i=0,len=items.length;i<len;i++){var item=items[i],path=item.getAttribute("data-path");"folder"==item.getAttribute("data-item-type")?data.folders.push(path):data.files.push(path)}return $.oc.stripeLoadIndicator.show(),this.$form.request(this.options.alias+"::onMoveItems",{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.itemsMoved)),ev.preventDefault(),!1},MediaManager.prototype.onMovePopupHidden=function(ev,button,popup){$(popup).off(".media","form")},MediaManager.prototype.itemsMoved=function(){this.$el.find('button[data-command="move"]').popup("hide"),this.afterNavigate()},MediaManager.prototype.onNavigate=function(ev){var $item=$(ev.target).closest('[data-type="media-item"]');if(this.navigateToItem($item),"public-url"!=$(ev.target).data("label"))return!1},MediaManager.prototype.onCommandClick=function(ev){switch($(ev.currentTarget).data("command")){case"refresh":this.refresh();break;case"change-view":this.changeView($(ev.currentTarget).data("view"));break;case"cancel-uploading":this.uploadCancelAll();break;case"close-uploader":this.hideUploadUi();break;case"set-filter":this.setFilter($(ev.currentTarget).data("filter"));break;case"delete":this.deleteItems();break;case"create-folder":this.createFolder(ev);break;case"move":this.moveItems(ev);break;case"toggle-sidebar":this.toggleSidebar(ev);break;case"popup-command":var popupCommand=$(ev.currentTarget).data("popup-command");"crop-and-insert"!==popupCommand?this.$el.trigger("popupcommand",[popupCommand]):this.cropSelectedImage(this.proxy(this.onImageCropped))}return!1},MediaManager.prototype.onItemClick=function(ev){"I"==ev.target.tagName&&ev.target.hasAttribute("data-rename-control")||this.selectItem(ev.currentTarget,ev.shiftKey)},MediaManager.prototype.onItemTouch=function(ev){ev.preventDefault(),ev.stopPropagation(),this.dblTouchFlag?(this.onNavigate(ev),this.dblTouchFlag=null):(this.onItemClick(ev),this.dblTouchFlag=!0),this.clearDblTouchTimer(),this.dblTouchTimer=setTimeout(this.proxy(this.clearDblTouchFlag),300)},MediaManager.prototype.onListMouseDown=function(ev){this.itemListElement.addEventListener("mousemove",this.proxy(this.onListMouseMove)),document.addEventListener("mouseup",this.proxy(this.onListMouseUp)),this.itemListPosition=$.oc.foundation.element.absolutePosition(this.itemListElement,!0);var pagePosition=$.oc.foundation.event.pageCoordinates(ev),relativePosition=this.getRelativePosition(this.itemListElement,pagePosition.x,pagePosition.y,this.itemListPosition);this.selectionStartPoint=relativePosition,this.selectionStarted=!1},MediaManager.prototype.onListMouseUp=function(ev){if(this.itemListElement.removeEventListener("mousemove",this.proxy(this.onListMouseMove)),document.removeEventListener("mouseup",this.proxy(this.onListMouseUp)),$(document.body).removeClass("no-select"),this.selectionStarted){this.unselectRoot();for(var items=this.itemListElement.querySelectorAll('[data-type="media-item"]:not([data-root])'),selectionPosition=$.oc.foundation.element.absolutePosition(this.selectionMarker,!0),index=0,len=items.length;index<len;index++){var item=items[index],itemPosition=$.oc.foundation.element.absolutePosition(item,!0);this.doObjectsCollide(selectionPosition.top,selectionPosition.left,this.selectionMarker.offsetWidth,this.selectionMarker.offsetHeight,itemPosition.top,itemPosition.left,item.offsetWidth,item.offsetHeight)?ev.shiftKey&&"selected"==item.getAttribute("class")?item.setAttribute("class",""):item.setAttribute("class","selected"):ev.shiftKey||item.setAttribute("class","")}this.updateSidebarPreview(),this.selectionMarker.setAttribute("class","oc-hide")}this.selectionStarted=!1},MediaManager.prototype.onListMouseMove=function(ev){var pagePosition=$.oc.foundation.event.pageCoordinates(ev),relativePosition=this.getRelativePosition(this.itemListElement,pagePosition.x,pagePosition.y,this.itemListPosition),deltaX=relativePosition.x-this.selectionStartPoint.x,deltaY=relativePosition.y-this.selectionStartPoint.y;!this.selectionStarted&&(Math.abs(deltaX)>2||Math.abs(deltaY)>2)&&(this.createSelectionMarker(),this.selectionMarker.setAttribute("class",""),this.selectionStarted=!0,$(document.body).addClass("no-select")),this.selectionStarted&&(deltaX>=0?(this.selectionMarker.style.left=this.selectionStartPoint.x+"px",this.selectionMarker.style.width=deltaX+"px"):(this.selectionMarker.style.left=relativePosition.x+"px",this.selectionMarker.style.width=Math.abs(deltaX)+"px"),deltaY>=0?(this.selectionMarker.style.height=deltaY+"px",this.selectionMarker.style.top=this.selectionStartPoint.y+"px"):(this.selectionMarker.style.top=relativePosition.y+"px",this.selectionMarker.style.height=Math.abs(deltaY)+"px"))},MediaManager.prototype.onSortingChanged=function(ev){var $target=$(ev.target),data={path:this.$el.find('[data-type="current-folder"]').val()};"by"==$target.data("sort")?data.sortBy=$target.val():"direction"==$target.data("sort")&&(data.sortDirection=$target.val()),this.execNavigationRequest("onSetSorting",data)},MediaManager.prototype.onKeyDown=function(ev){var eventHandled=!1;switch(ev.key){case"Enter":var items=this.getSelectedItems(!0,!0);items.length>0&&this.navigateToItem($(items[0])),eventHandled=!0;break;case"ArrowRight":case"ArrowDown":this.selectRelative(!0,ev.shiftKey),eventHandled=!0;break;case"ArrowLeft":case"ArrowUp":this.selectRelative(!1,ev.shiftKey),eventHandled=!0}eventHandled&&(ev.preventDefault(),ev.stopPropagation())},MediaManager.DEFAULTS={url:window.location,alias:"",uniqueId:null,deleteEmpty:"Please select files to delete.",deleteConfirm:"Delete the selected file(s)?",moveEmpty:"Please select files to move.",selectSingleImage:"Please select a single image.",selectionNotImage:"The selected item is not an image.",bottomToolbar:!1,cropAndInsertButton:!1};var old=$.fn.mediaManager;$.fn.mediaManager=function(option){var args=Array.prototype.slice.call(arguments,1),result=void 0;return this.each((function(){var $this=$(this),data=$this.data("oc.mediaManager"),options=$.extend({},MediaManager.DEFAULTS,$this.data(),"object"==typeof option&&option);if(data||$this.data("oc.mediaManager",data=new MediaManager(this,options)),"string"==typeof option&&(result=data[option].apply(data,args)),void 0!==result)return!1})),result||this},$.fn.mediaManager.Constructor=MediaManager,$.fn.mediaManager.noConflict=function(){return $.fn.mediaManager=old,this},$(document).on("render",(function(){$("div[data-control=media-manager]").mediaManager()}))}(window.jQuery),function($){"use strict";void 0===$.oc.mediaManager&&($.oc.mediaManager={});var Base=$.oc.foundation.base,BaseProto=Base.prototype,MediaManagerImageCropPopup=function(path,options){this.$popupRootElement=null,this.$popupElement=null,this.selectionSizeLabel=null,this.imageArea=null,this.hRulerHolder=null,this.vRulerHolder=null,this.rulersVisible=!1,this.prevScrollTop=0,this.prevScrollLeft=0,this.jCrop=null,this.options=$.extend({},MediaManagerImageCropPopup.DEFAULTS,options),this.path=path,Base.call(this),this.init(),this.show()};MediaManagerImageCropPopup.prototype=Object.create(BaseProto),MediaManagerImageCropPopup.prototype.constructor=MediaManagerImageCropPopup,MediaManagerImageCropPopup.prototype.dispose=function(){this.unregisterHandlers(),this.removeAttachedControls(),this.$popupRootElement.remove(),this.$popupRootElement=null,this.$popupElement=null,this.selectionSizeLabel=null,this.imageArea=null,this.hRulerHolder=null,this.vRulerHolder=null,BaseProto.dispose.call(this)},MediaManagerImageCropPopup.prototype.init=function(){if(void 0===this.options.alias)throw new Error('Media Manager image crop popup option "alias" is not set.');this.$popupRootElement=$("<div/>"),this.registerHandlers()},MediaManagerImageCropPopup.prototype.show=function(){var data={path:this.path};this.$popupRootElement.popup({extraData:data,size:"adaptive",adaptiveHeight:!0,handler:this.options.alias+"::onLoadImageCropPopup"})},MediaManagerImageCropPopup.prototype.registerHandlers=function(){this.$popupRootElement.one("hide.oc.popup",this.proxy(this.onPopupHidden)),this.$popupRootElement.one("shown.oc.popup",this.proxy(this.onPopupShown))},MediaManagerImageCropPopup.prototype.unregisterHandlers=function(){if(this.$popupElement.off("change",'[data-control="selection-mode"]',this.proxy(this.onSelectionModeChanged)),this.$popupElement.off("click","[data-command]",this.proxy(this.onCommandClick)),this.$popupElement.off("shown.oc.popup","button[data-command=resize]",this.proxy(this.onResizePopupShown)),this.$popupElement.off("hidden.oc.popup","button[data-command=resize]",this.proxy(this.onResizePopupHidden)),this.rulersVisible){this.$popupElement.find("[data-control=media-manager-crop-tool]");this.imageArea.removeEventListener("scroll",this.proxy(this.onImageScroll))}this.getWidthInput().off("change",this.proxy(this.onSizeInputChange)),this.getHeightInput().off("change",this.proxy(this.onSizeInputChange))},MediaManagerImageCropPopup.prototype.removeAttachedControls=function(){this.$popupElement&&(this.$popupElement.find('[data-control="selection-mode"]').select2("destroy").remove(),this.$popupElement.find("[data-control=toolbar]").toolbar("dispose").remove(),this.jCrop.destroy()),this.jCrop=null},MediaManagerImageCropPopup.prototype.hide=function(){this.$popupElement&&this.$popupElement.trigger("close.oc.popup")},MediaManagerImageCropPopup.prototype.getSelectionMode=function(){return this.$popupElement.find('[data-control="selection-mode"]').val()},MediaManagerImageCropPopup.prototype.initRulers=function(){if(Modernizr.csstransforms){var $cropToolRoot=this.$popupElement.find("[data-control=media-manager-crop-tool]"),width=$cropToolRoot.data("image-width"),height=$cropToolRoot.data("image-height");if(width&&height){$cropToolRoot.width()>width&&(width=$(window).width()),$cropToolRoot.height()>height&&(height=$(window).height()),$cropToolRoot.find(".ruler-container").removeClass("oc-hide"),$cropToolRoot.addClass("has-rulers");var $hRuler=$cropToolRoot.find("[data-control=h-ruler]"),$vRuler=$cropToolRoot.find("[data-control=v-ruler]"),hTicks=width/40+1,vTicks=height/40+1;this.createRulerTicks($hRuler,hTicks),this.createRulerTicks($vRuler,vTicks),this.rulersVisible=!0,this.imageArea.addEventListener("scroll",this.proxy(this.onImageScroll)),this.hRulerHolder=$cropToolRoot.find(".ruler-container.horizontal .layout-relative").get(0),this.vRulerHolder=$cropToolRoot.find(".ruler-container.vertical .layout-relative").get(0)}}},MediaManagerImageCropPopup.prototype.createRulerTicks=function($rulerElement,count){for(var list=document.createElement("ul"),i=0;i<=count;i++){var li=document.createElement("li");li.textContent=40*i,list.appendChild(li)}$rulerElement.append(list)},MediaManagerImageCropPopup.prototype.initJCrop=function(){this.jCrop=$.Jcrop($(this.imageArea).find("img").get(0),{shade:!0,onChange:this.proxy(this.onSelectionChanged)})},MediaManagerImageCropPopup.prototype.fixDimensionValue=function(value){var result=value.replace(/[^0-9]+/,"");return result.length||(result=200),"0"==result&&(result=1),result},MediaManagerImageCropPopup.prototype.getWidthInput=function(){return this.$popupElement.find('[data-control="crop-width-input"]')},MediaManagerImageCropPopup.prototype.getHeightInput=function(){return this.$popupElement.find('[data-control="crop-height-input"]')},MediaManagerImageCropPopup.prototype.applySelectionMode=function(){if(this.jCrop){var $widthInput=this.getWidthInput(),$heightInput=this.getHeightInput(),width=this.fixDimensionValue($widthInput.val()),height=this.fixDimensionValue($heightInput.val());switch(this.getSelectionMode()){case"fixed-ratio":this.jCrop.setOptions({aspectRatio:width/height,minSize:[0,0],maxSize:[0,0],allowResize:!0});break;case"fixed-size":this.jCrop.setOptions({aspectRatio:0,minSize:[width,height],maxSize:[width,height],allowResize:!1});break;case"normal":this.jCrop.setOptions({aspectRatio:0,minSize:[0,0],maxSize:[0,0],allowResize:!0})}}},MediaManagerImageCropPopup.prototype.cropAndInsert=function(){var data={img:$(this.imageArea).find("img").attr("src"),selection:this.jCrop.tellSelect()};$.oc.stripeLoadIndicator.show(),this.$popupElement.find("form").request(this.options.alias+"::onCropImage",{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.onImageCropped))},MediaManagerImageCropPopup.prototype.onImageCropped=function(response){this.hide(),void 0!==this.options.onDone&&this.options.onDone(response)},MediaManagerImageCropPopup.prototype.showResizePopup=function(){this.$popupElement.find("button[data-command=resize]").popup({content:this.$popupElement.find('[data-control="resize-template"]').html(),zIndex:1220})},MediaManagerImageCropPopup.prototype.onResizePopupShown=function(ev,button,popup){var $popup=$(popup),$widthControl=$popup.find("input[name=width]"),$heightControl=$popup.find("input[name=height]"),imageWidth=this.fixDimensionValue(this.$popupElement.find("input[data-control=dimension-width]").val()),imageHeight=this.fixDimensionValue(this.$popupElement.find("input[data-control=dimension-height]").val());$widthControl.val(imageWidth),$heightControl.val(imageHeight),$widthControl.focus(),$popup.on("submit.media","form",this.proxy(this.onResizeSubmit)),$widthControl.on("keyup.media",this.proxy(this.onResizeDimensionKeyUp)),$heightControl.on("keyup.media",this.proxy(this.onResizeDimensionKeyUp)),$widthControl.on("change.media",this.proxy(this.onResizeDimensionChanged)),$heightControl.on("change.media",this.proxy(this.onResizeDimensionChanged))},MediaManagerImageCropPopup.prototype.onResizePopupHidden=function(ev,button,popup){var $popup=$(popup),$widthControl=$popup.find("input[name=width]"),$heightControl=$popup.find("input[name=height]");$popup.off(".media","form"),$widthControl.off(".media"),$heightControl.off(".media")},MediaManagerImageCropPopup.prototype.onResizeDimensionKeyUp=function(ev){var $target=$(ev.target),targetValue=this.fixDimensionValue($target.val()),otherDimensionName="width"==$target.attr("name")?"height":"width",$otherInput=$target.closest("form").find("input[name="+otherDimensionName+"]"),ratio=this.$popupElement.find("[data-control=original-ratio]").val(),value="height"==otherDimensionName?targetValue/ratio:targetValue*ratio;$otherInput.val(Math.round(value))},MediaManagerImageCropPopup.prototype.onResizeDimensionChanged=function(ev){var $target=$(ev.target);$target.val(this.fixDimensionValue($target.val()))},MediaManagerImageCropPopup.prototype.onResizeSubmit=function(ev){var data={cropSessionKey:this.$popupElement.find("input[name=cropSessionKey]").val(),path:this.$popupElement.find("input[name=path]").val()};return $.oc.stripeLoadIndicator.show(),$(ev.target).request(this.options.alias+"::onResizeImage",{data:data}).always((function(){$.oc.stripeLoadIndicator.hide()})).done(this.proxy(this.imageResized)),ev.preventDefault(),!1},MediaManagerImageCropPopup.prototype.imageResized=function(response){this.$popupElement.find("button[data-command=resize]").popup("hide"),this.updateImage(response.url,response.dimensions[0],response.dimensions[1])},MediaManagerImageCropPopup.prototype.updateImage=function(url,width,hegiht){this.jCrop.destroy(),this.$popupElement.find("span[data-label=width]").text(width),this.$popupElement.find("span[data-label=height]").text(hegiht),this.$popupElement.find("input[data-control=dimension-width]").val(width),this.$popupElement.find("input[data-control=dimension-height]").val(hegiht);var $imageArea=$(this.imageArea);$imageArea.find("img").remove();var $img=$("<img>").attr("src",url);$img.one("load",this.proxy(this.initJCrop)),$imageArea.append($img),this.imageArea.scrollTop=0,this.imageArea.scrollLeft=0,this.onImageScroll()},MediaManagerImageCropPopup.prototype.undoResizing=function(){this.updateImage(this.$popupElement.find("input[data-control=original-url]").val(),this.$popupElement.find("input[data-control=original-width]").val(),this.$popupElement.find("input[data-control=original-height]").val())},MediaManagerImageCropPopup.prototype.updateSelectionSizeLabel=function(width,height){0!=width||0!=height?(this.selectionSizeLabel.setAttribute("class",""),this.selectionSizeLabel.querySelector("[data-label=selection-width]").textContent=parseInt(width),this.selectionSizeLabel.querySelector("[data-label=selection-height]").textContent=parseInt(height)):this.selectionSizeLabel.setAttribute("class","oc-hide")},MediaManagerImageCropPopup.prototype.onPopupHidden=function(event,element,popup){this.$popupElement.find("form").request(this.options.alias+"::onEndCroppingSession"),$(document).trigger("mousedown"),this.dispose()},MediaManagerImageCropPopup.prototype.onPopupShown=function(event,element,popup){this.$popupElement=popup,this.$popupElement.on("change",'[data-control="selection-mode"]',this.proxy(this.onSelectionModeChanged)),this.$popupElement.on("click","[data-command]",this.proxy(this.onCommandClick)),this.$popupElement.on("shown.oc.popup","button[data-command=resize]",this.proxy(this.onResizePopupShown)),this.$popupElement.on("hidden.oc.popup","button[data-command=resize]",this.proxy(this.onResizePopupHidden)),this.imageArea=popup.find("[data-control=media-manager-crop-tool]").get(0).querySelector(".image_area"),this.selectionSizeLabel=popup.find('[data-label="selection-size"]').get(0),this.getWidthInput().on("change",this.proxy(this.onSizeInputChange)),this.getHeightInput().on("change",this.proxy(this.onSizeInputChange)),this.initRulers(),this.initJCrop(),this.applySelectionMode()},MediaManagerImageCropPopup.prototype.onSelectionModeChanged=function(){var mode=this.getSelectionMode(),$widthInput=this.getWidthInput(),$heightInput=this.getHeightInput();"normal"===mode?($widthInput.attr("disabled","disabled"),$heightInput.attr("disabled","disabled")):($widthInput.removeAttr("disabled"),$heightInput.removeAttr("disabled"),$widthInput.val(this.fixDimensionValue($widthInput.val())),$heightInput.val(this.fixDimensionValue($heightInput.val()))),this.applySelectionMode()},MediaManagerImageCropPopup.prototype.onImageScroll=function(){var scrollTop=this.imageArea.scrollTop,scrollLeft=this.imageArea.scrollLeft;this.prevScrollTop!=scrollTop&&(this.prevScrollTop=scrollTop,this.vRulerHolder.scrollTop=scrollTop),this.prevScrollLeft!=scrollLeft&&(this.prevScrollLeft=scrollLeft,this.hRulerHolder.scrollLeft=scrollLeft)},MediaManagerImageCropPopup.prototype.onSizeInputChange=function(ev){var $target=$(ev.target);$target.val(this.fixDimensionValue($target.val())),this.applySelectionMode()},MediaManagerImageCropPopup.prototype.onCommandClick=function(ev){switch($(ev.currentTarget).data("command")){case"insert":this.cropAndInsert();break;case"resize":this.showResizePopup();break;case"undo-resizing":this.undoResizing()}},MediaManagerImageCropPopup.prototype.onSelectionChanged=function(c){this.updateSelectionSizeLabel(c.w,c.h)},MediaManagerImageCropPopup.DEFAULTS={alias:void 0,onDone:void 0},$.oc.mediaManager.imageCropPopup=MediaManagerImageCropPopup}(window.jQuery),function($){"use strict";void 0===$.oc.mediaManager&&($.oc.mediaManager={});var Base=$.oc.foundation.base,BaseProto=Base.prototype,MediaManagerPopup=function(options){this.$popupRootElement=null,this.options=$.extend({},MediaManagerPopup.DEFAULTS,options),Base.call(this),this.init(),this.show()};MediaManagerPopup.prototype=Object.create(BaseProto),MediaManagerPopup.prototype.constructor=MediaManagerPopup,MediaManagerPopup.prototype.dispose=function(){this.unregisterHandlers(),this.$popupRootElement.remove(),this.$popupRootElement=null,this.$popupElement=null,BaseProto.dispose.call(this)},MediaManagerPopup.prototype.init=function(){if(void 0===this.options.alias)throw new Error('Media Manager popup option "alias" is not set.');this.$popupRootElement=$("<div/>"),this.registerHandlers()},MediaManagerPopup.prototype.registerHandlers=function(){this.$popupRootElement.one("hide.oc.popup",this.proxy(this.onPopupHidden)),this.$popupRootElement.one("shown.oc.popup",this.proxy(this.onPopupShown))},MediaManagerPopup.prototype.unregisterHandlers=function(){this.$popupElement.off("popupcommand",this.proxy(this.onPopupCommand)),this.$popupRootElement.off("popupcommand",this.proxy(this.onPopupCommand))},MediaManagerPopup.prototype.show=function(){var data={bottomToolbar:this.options.bottomToolbar?1:0,cropAndInsertButton:this.options.cropAndInsertButton?1:0};this.$popupRootElement.popup({extraData:data,size:"adaptive",adaptiveHeight:!0,handler:this.options.alias+"::onLoadPopup"})},MediaManagerPopup.prototype.hide=function(){this.$popupElement&&this.$popupElement.trigger("close.oc.popup")},MediaManagerPopup.prototype.getMediaManagerElement=function(){return this.$popupElement.find('[data-control="media-manager"]')},MediaManagerPopup.prototype.insertMedia=function(){var items=this.getMediaManagerElement().mediaManager("getSelectedItems");void 0!==this.options.onInsert&&this.options.onInsert.call(this,items)},MediaManagerPopup.prototype.insertCroppedImage=function(imageItem){void 0!==this.options.onInsert&&this.options.onInsert.call(this,[imageItem])},MediaManagerPopup.prototype.onPopupHidden=function(event,element,popup){var mediaManager=this.getMediaManagerElement();mediaManager.mediaManager("dispose"),mediaManager.remove(),$(document).trigger("mousedown"),this.dispose(),void 0!==this.options.onClose&&this.options.onClose.call(this)},MediaManagerPopup.prototype.onPopupShown=function(event,element,popup){this.$popupElement=popup,this.$popupElement.on("popupcommand",this.proxy(this.onPopupCommand)),this.getMediaManagerElement().mediaManager("selectFirstItem")},MediaManagerPopup.prototype.onPopupCommand=function(ev,command,param){switch(command){case"insert":this.insertMedia();break;case"insert-cropped":this.insertCroppedImage(param)}return!1},MediaManagerPopup.DEFAULTS={alias:void 0,bottomToolbar:!0,cropAndInsertButton:!1,onInsert:void 0,onClose:void 0},$.oc.mediaManager.popup=MediaManagerPopup}(window.jQuery);
